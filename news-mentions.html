<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>News & Media Mentions - Castle Comms</title>
  
  <!-- Security Headers -->
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  
  <link rel="stylesheet" href="style.css" />
  <style>
    .news-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      backdrop-filter: blur(10px);
      min-height: 90vh;
    }

    .news-header {
      text-align: center;
      margin-bottom: 3rem;
      border-bottom: 3px solid var(--primary-gradient);
      padding-bottom: 2rem;
    }

    .news-title {
      font-family: 'Times New Roman', serif;
      font-size: 3rem;
      font-weight: bold;
      color: #1a1a1a;
      margin: 0 0 0.5rem 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .news-subtitle {
      font-size: 1.2rem;
      color: #666;
      font-style: italic;
      margin: 0;
    }

    .news-date {
      font-size: 1rem;
      color: #888;
      margin-top: 0.5rem;
    }

    /* Add URL Form */
    .add-url-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 3rem;
      color: white;
    }

    .add-url-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .url-form {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .url-input {
      flex: 1;
      min-width: 300px;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }

    .url-input:focus {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .add-url-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .add-url-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }

    .add-url-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .add-url-btn.loading {
      position: relative;
      color: transparent;
    }

    .add-url-btn.loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .url-status {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.9rem;
      display: none;
    }

    .url-status.success {
      background: rgba(34, 197, 94, 0.2);
      color: #15803d;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .url-status.error {
      background: rgba(239, 68, 68, 0.2);
      color: #dc2626;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    /* Newspaper Layout */
    .news-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .main-stories {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .sidebar-stories {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Featured Story */
    .featured-story {
      border: 2px solid #e5e5e5;
      border-radius: 12px;
      overflow: hidden;
      background: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .featured-story:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .featured-story .story-image {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 3rem;
      overflow: hidden;
      position: relative;
    }

    .featured-story .story-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    .featured-story .story-image .placeholder-icon {
      z-index: 1;
      position: relative;
    }

    .featured-story .story-content {
      padding: 1.5rem;
    }

    .featured-story .story-title {
      font-family: 'Times New Roman', serif;
      font-size: 1.8rem;
      font-weight: bold;
      color: #1a1a1a;
      margin: 0 0 1rem 0;
      line-height: 1.3;
    }

    .featured-story .story-preview {
      color: #555;
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .featured-story .story-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #888;
      font-size: 0.9rem;
      border-top: 1px solid #eee;
      padding-top: 1rem;
    }

    /* Regular Stories */
    .story-card {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .story-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    }

    .story-card .story-image {
      width: 100%;
      height: 120px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      overflow: hidden;
      position: relative;
    }

    .story-card .story-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    .story-card .story-image .placeholder-icon {
      z-index: 1;
      position: relative;
    }

    .story-card .story-content {
      padding: 1rem;
    }

    .story-card .story-title {
      font-family: 'Times New Roman', serif;
      font-size: 1.2rem;
      font-weight: bold;
      color: #1a1a1a;
      margin: 0 0 0.5rem 0;
      line-height: 1.4;
    }

    .story-card .story-preview {
      color: #666;
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }

    .story-card .story-meta {
      color: #888;
      font-size: 0.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .story-source {
      font-weight: 600;
      color: var(--primary-color, #667eea);
    }

    .story-date {
      font-size: 0.8rem;
    }

    /* Secondary Stories */
    .secondary-stories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    /* Loading States */
    .loading-placeholder {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
      height: 300px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #666;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #444;
    }

    .empty-state p {
      font-size: 1rem;
      margin: 0;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .news-container {
        margin: 1rem;
        padding: 1rem;
      }

      .news-title {
        font-size: 2rem;
      }

      .news-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .url-form {
        flex-direction: column;
      }

      .url-input {
        min-width: auto;
      }

      .secondary-stories {
        grid-template-columns: 1fr;
      }

      .featured-story .story-title {
        font-size: 1.5rem;
      }

      .story-card .story-title {
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>

<!-- Background Slideshow -->
<div class="background-slideshow" id="background-slideshow">
  <!-- Images will be injected by JavaScript -->
</div>
  
<header>
  <button id="menu-toggle" class="hamburger">&#9776;</button>
  <h1>Castle Comms</h1>
</header>

<div id="notification-bell" class="notification-bell hidden">
  ðŸ”” <span id="notification-count" class="count-badge">0</span>
</div>

<div id="sidebar-container"></div>

<main id="main">
  <div class="news-container">
    <!-- Newspaper Header -->
    <div class="news-header">
      <h1 class="news-title">ðŸ“° Castle Fine Art News</h1>
      <p class="news-subtitle">Media Mentions & Press Coverage</p>
      <p class="news-date" id="current-date"></p>
    </div>

    <!-- Add URL Section -->
    <div class="add-url-section">
      <h2 class="add-url-title">
        ðŸ”— Add News Article
      </h2>
      <div class="url-form">
        <input 
          type="url" 
          id="news-url-input" 
          class="url-input" 
          placeholder="Paste article URL here (e.g., https://example.com/article)"
        />
        <button id="add-url-btn" class="add-url-btn">
          Add Article
        </button>
      </div>
      <div id="url-status" class="url-status"></div>
    </div>

    <!-- News Grid -->
    <div class="news-grid">
      <!-- Main Stories Column -->
      <div class="main-stories">
        <div id="featured-story-container">
          <!-- Featured story will be inserted here -->
        </div>
        <div id="main-stories-container">
          <!-- Main stories will be inserted here -->
        </div>
      </div>

      <!-- Sidebar Stories Column -->
      <div class="sidebar-stories">
        <div id="sidebar-stories-container">
          <!-- Sidebar stories will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Secondary Stories -->
    <div class="secondary-stories" id="secondary-stories-container">
      <!-- Secondary stories will be inserted here -->
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="empty-state" style="display: none;">
      <div class="empty-state-icon">ðŸ“°</div>
      <h3>No News Articles Yet</h3>
      <p>Add your first news article using the form above!</p>
    </div>
  </div>
</main>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<!-- Firebase config -->
<script src="firebase-init.js"></script>

<!-- Shared components -->
<script src="shared-components.js"></script>

<!-- News Mentions Logic -->
<script>
let newsArticles = [];

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  // Set current date
  const currentDate = new Date().toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  document.getElementById('current-date').textContent = currentDate;

  // Load existing articles
  loadNewsArticles();

  // Setup form submission
  setupUrlForm();
});

// Load news articles from Firebase
async function loadNewsArticles() {
  try {
    const newsRef = firebase.database().ref('news-articles');
    const snapshot = await newsRef.orderByChild('timestamp').once('value');
    const data = snapshot.val();
    
    if (data) {
      newsArticles = Object.keys(data)
        .map(key => ({ id: key, ...data[key] }))
        .sort((a, b) => b.timestamp - a.timestamp);
    } else {
      newsArticles = [];
    }
    
    renderNewsArticles();
    console.log('âœ… News articles loaded:', newsArticles.length);
  } catch (error) {
    console.error('âŒ Error loading news articles:', error);
    showEmptyState();
  }
}

// Setup URL form
function setupUrlForm() {
  const urlInput = document.getElementById('news-url-input');
  const addBtn = document.getElementById('add-url-btn');
  const status = document.getElementById('url-status');

  addBtn.addEventListener('click', async () => {
    const url = urlInput.value.trim();
    
    if (!url) {
      showStatus('Please enter a valid URL', 'error');
      return;
    }

    if (!isValidUrl(url)) {
      showStatus('Please enter a valid URL starting with http:// or https://', 'error');
      return;
    }

    // Show loading state
    addBtn.classList.add('loading');
    addBtn.disabled = true;

    try {
      await addNewsArticle(url);
      urlInput.value = '';
      showStatus('Article added successfully!', 'success');
      
      // Hide status after 3 seconds
      setTimeout(() => {
        status.style.display = 'none';
      }, 3000);
      
    } catch (error) {
      console.error('Error adding article:', error);
      showStatus('Failed to add article. Please try again.', 'error');
    }

    // Remove loading state
    addBtn.classList.remove('loading');
    addBtn.disabled = false;
  });

  // Allow Enter key submission
  urlInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      addBtn.click();
    }
  });
}

// Add news article
async function addNewsArticle(url) {
  try {
    // Extract metadata from URL
    const metadata = await extractUrlMetadata(url);
    
    // Save to Firebase
    const newsRef = firebase.database().ref('news-articles').push();
    await newsRef.set({
      url: url,
      title: metadata.title,
      description: metadata.description,
      image: metadata.image,
      site_name: metadata.site_name,
      timestamp: Date.now(),
      addedBy: firebase.auth().currentUser?.email || 'unknown'
    });

    // Reload articles
    await loadNewsArticles();
    
  } catch (error) {
    throw error;
  }
}

// Extract metadata from URL using multiple methods
async function extractUrlMetadata(url) {
  try {
    const urlObj = new URL(url);
    
    // Try multiple extraction methods in order of preference
    let metadata = null;
    
    // Method 1: Try using a CORS proxy to fetch the page directly
    try {
      metadata = await extractViaCorProxy(url);
      if (metadata && metadata.title && metadata.title !== 'Article from ' + urlObj.hostname) {
        return metadata;
      }
    } catch (error) {
      console.log('CORS proxy method failed:', error.message);
    }
    
    // Method 2: Try using Open Graph / Link Preview services
    try {
      metadata = await extractViaLinkPreview(url);
      if (metadata && metadata.title && metadata.title !== 'Article from ' + urlObj.hostname) {
        return metadata;
      }
    } catch (error) {
      console.log('Link preview method failed:', error.message);
    }
    
    // Method 3: Intelligent fallback based on URL patterns
    metadata = generateIntelligentFallback(url, urlObj);
    return metadata;
    
  } catch (error) {
    console.error('All metadata extraction methods failed:', error);
    return {
      title: 'News Article',
      description: 'Click to read the full article...',
      image: null,
      site_name: 'News Source'
    };
  }
}

// Method 1: Extract via CORS proxy
async function extractViaCorProxy(url) {
  const proxyUrls = [
    `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
    `https://cors-anywhere.herokuapp.com/${url}`,
  ];
  
  for (const proxyUrl of proxyUrls) {
    try {
      const response = await fetch(proxyUrl, {
        method: 'GET',
        headers: {
          'User-Agent': 'Mozilla/5.0 (compatible; CastleComms/1.0)',
        },
        timeout: 10000
      });
      
      if (!response.ok) continue;
      
      let html;
      const data = await response.json();
      if (data.contents) {
        html = data.contents; // allorigins format
      } else {
        html = await response.text(); // direct fetch format
      }
      
      return parseHtmlMetadata(html, url);
    } catch (error) {
      console.log(`Proxy ${proxyUrl} failed:`, error.message);
      continue;
    }
  }
  
  throw new Error('All CORS proxies failed');
}

// Method 2: Extract via link preview services
async function extractViaLinkPreview(url) {
  const services = [
    {
      name: 'LinkPreview',
      url: `https://api.linkpreview.net/?key=demo&q=${encodeURIComponent(url)}`,
      parse: (data) => ({
        title: data.title,
        description: data.description,
        image: data.image,
        site_name: data.url ? new URL(data.url).hostname.replace('www.', '') : null
      })
    }
  ];
  
  for (const service of services) {
    try {
      const response = await fetch(service.url, { timeout: 8000 });
      if (!response.ok) continue;
      
      const data = await response.json();
      const metadata = service.parse(data);
      
      if (metadata.title && metadata.title.length > 3) {
        return metadata;
      }
    } catch (error) {
      console.log(`${service.name} failed:`, error.message);
      continue;
    }
  }
  
  throw new Error('All link preview services failed');
}

// Parse HTML to extract metadata
function parseHtmlMetadata(html, url) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, 'text/html');
  const urlObj = new URL(url);
  
  // Extract title (priority: og:title > twitter:title > title tag > h1)
  let title = getMetaContent(doc, 'property', 'og:title') ||
              getMetaContent(doc, 'name', 'twitter:title') ||
              doc.querySelector('title')?.textContent?.trim() ||
              doc.querySelector('h1')?.textContent?.trim();
  
  // Extract description (priority: og:description > twitter:description > meta description)
  let description = getMetaContent(doc, 'property', 'og:description') ||
                   getMetaContent(doc, 'name', 'twitter:description') ||
                   getMetaContent(doc, 'name', 'description');
  
  // Extract image (priority: og:image > twitter:image > first img)
  let image = getMetaContent(doc, 'property', 'og:image') ||
              getMetaContent(doc, 'name', 'twitter:image') ||
              doc.querySelector('img')?.src;
  
  // Make image URL absolute if needed
  if (image && !image.startsWith('http')) {
    image = new URL(image, url).href;
  }
  
  // Extract site name
  let site_name = getMetaContent(doc, 'property', 'og:site_name') ||
                  urlObj.hostname.replace('www.', '');
  
  // Clean up extracted data
  title = cleanText(title) || `Article from ${site_name}`;
  description = cleanText(description) || 'Click to read the full article...';
  
  return { title, description, image, site_name };
}

// Helper function to get meta content
function getMetaContent(doc, attribute, value) {
  const meta = doc.querySelector(`meta[${attribute}="${value}"]`);
  return meta?.getAttribute('content')?.trim();
}

// Helper function to clean extracted text
function cleanText(text) {
  if (!text) return null;
  return text
    .replace(/\s+/g, ' ')
    .replace(/[\r\n\t]/g, ' ')
    .trim()
    .substring(0, 200); // Limit length
}

// Method 3: Intelligent fallback based on URL patterns
function generateIntelligentFallback(url, urlObj) {
  const hostname = urlObj.hostname.toLowerCase();
  const path = urlObj.pathname.toLowerCase();
  
  // News site patterns and titles
  const newsPatterns = {
    'bbc.co.uk': 'BBC News Article',
    'bbc.com': 'BBC News Article', 
    'theguardian.com': 'The Guardian Article',
    'independent.co.uk': 'The Independent Article',
    'telegraph.co.uk': 'The Telegraph Article',
    'dailymail.co.uk': 'Daily Mail Article',
    'mirror.co.uk': 'The Mirror Article',
    'express.co.uk': 'Daily Express Article',
    'metro.co.uk': 'Metro Article',
    'standard.co.uk': 'Evening Standard Article',
    'reuters.com': 'Reuters News',
    'cnn.com': 'CNN Article',
    'nytimes.com': 'New York Times Article',
    'washingtonpost.com': 'Washington Post Article',
    'wsj.com': 'Wall Street Journal Article',
    'bloomberg.com': 'Bloomberg Article',
    'ft.com': 'Financial Times Article',
    'reuters.com': 'Reuters Article',
    'ap.org': 'Associated Press Article'
  };
  
  // Art-specific publications
  const artPatterns = {
    'artnet.com': 'Artnet News',
    'artnews.com': 'ARTnews Article',
    'artforum.com': 'Artforum Article',
    'frieze.com': 'Frieze Article',
    'theartnewspaper.com': 'The Art Newspaper Article',
    'apollo-magazine.com': 'Apollo Magazine Article',
    'wallpaper.com': 'Wallpaper Magazine Article',
    'dezeen.com': 'Dezeen Article'
  };
  
  // Try to extract a meaningful title from URL path
  let extractedTitle = null;
  if (path.includes('/')) {
    const pathParts = path.split('/').filter(p => p.length > 0);
    const lastPart = pathParts[pathParts.length - 1];
    
    if (lastPart && lastPart !== 'index.html' && lastPart !== 'index.php') {
      extractedTitle = lastPart
        .replace(/[-_]/g, ' ')
        .replace(/\.(html|php|asp|aspx)$/i, '')
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    }
  }
  
  // Determine site name and base title
  const siteName = urlObj.hostname.replace('www.', '');
  const baseTitle = newsPatterns[hostname] || artPatterns[hostname] || 
                   `Article from ${siteName.split('.')[0].charAt(0).toUpperCase() + siteName.split('.')[0].slice(1)}`;
  
  const finalTitle = extractedTitle && extractedTitle.length > 5 ? 
                     `${extractedTitle} - ${baseTitle}` : baseTitle;
  
  return {
    title: finalTitle,
    description: `Read the full article from ${siteName}`,
    image: null,
    site_name: siteName
  };
}

// Render news articles in newspaper layout
function renderNewsArticles() {
  if (newsArticles.length === 0) {
    showEmptyState();
    return;
  }

  hideEmptyState();

  const featured = newsArticles[0];
  const mainStories = newsArticles.slice(1, 4);
  const sidebarStories = newsArticles.slice(4, 8);
  const secondaryStories = newsArticles.slice(8);

  // Render featured story
  renderFeaturedStory(featured);
  
  // Render main stories
  renderMainStories(mainStories);
  
  // Render sidebar stories
  renderSidebarStories(sidebarStories);
  
  // Render secondary stories
  renderSecondaryStories(secondaryStories);
}

// Render featured story
function renderFeaturedStory(story) {
  const container = document.getElementById('featured-story-container');
  if (!story) {
    container.innerHTML = '';
    return;
  }

  const imageHtml = story.image ? 
    `<img src="${story.image}" alt="${story.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
     <div class="placeholder-icon" style="display: none;">ðŸ“°</div>` :
    `<div class="placeholder-icon">ðŸ“°</div>`;

  container.innerHTML = `
    <div class="featured-story" onclick="openArticle('${story.url}')">
      <div class="story-image">
        ${imageHtml}
      </div>
      <div class="story-content">
        <h2 class="story-title">${story.title}</h2>
        <p class="story-preview">${story.description}</p>
        <div class="story-meta">
          <span class="story-source">${story.site_name}</span>
          <span class="story-date">${formatDate(story.timestamp)}</span>
        </div>
      </div>
    </div>
  `;
}

// Render main stories
function renderMainStories(stories) {
  const container = document.getElementById('main-stories-container');
  
  if (!stories || stories.length === 0) {
    container.innerHTML = '';
    return;
  }

  container.innerHTML = stories.map(story => {
    const imageHtml = story.image ? 
      `<img src="${story.image}" alt="${story.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
       <div class="placeholder-icon" style="display: none;">ðŸ“„</div>` :
      `<div class="placeholder-icon">ðŸ“„</div>`;
      
    return `
      <div class="story-card" onclick="openArticle('${story.url}')">
        <div class="story-image">
          ${imageHtml}
        </div>
        <div class="story-content">
          <h3 class="story-title">${story.title}</h3>
          <p class="story-preview">${story.description}</p>
          <div class="story-meta">
            <span class="story-source">${story.site_name}</span>
            <span class="story-date">${formatDate(story.timestamp)}</span>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// Render sidebar stories
function renderSidebarStories(stories) {
  const container = document.getElementById('sidebar-stories-container');
  
  if (!stories || stories.length === 0) {
    container.innerHTML = '<div class="loading-placeholder"></div>';
    return;
  }

  container.innerHTML = stories.map(story => {
    const imageHtml = story.image ? 
      `<img src="${story.image}" alt="${story.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
       <div class="placeholder-icon" style="display: none;">ðŸ“‹</div>` :
      `<div class="placeholder-icon">ðŸ“‹</div>`;
      
    return `
      <div class="story-card" onclick="openArticle('${story.url}')">
        <div class="story-image">
          ${imageHtml}
        </div>
        <div class="story-content">
          <h3 class="story-title">${story.title}</h3>
          <div class="story-meta">
            <span class="story-source">${story.site_name}</span>
            <span class="story-date">${formatDate(story.timestamp)}</span>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// Render secondary stories
function renderSecondaryStories(stories) {
  const container = document.getElementById('secondary-stories-container');
  
  if (!stories || stories.length === 0) {
    container.innerHTML = '';
    return;
  }

  container.innerHTML = stories.map(story => {
    const imageHtml = story.image ? 
      `<img src="${story.image}" alt="${story.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
       <div class="placeholder-icon" style="display: none;">ðŸ“°</div>` :
      `<div class="placeholder-icon">ðŸ“°</div>`;
      
    return `
      <div class="story-card" onclick="openArticle('${story.url}')">
        <div class="story-image">
          ${imageHtml}
        </div>
        <div class="story-content">
          <h3 class="story-title">${story.title}</h3>
          <p class="story-preview">${story.description}</p>
          <div class="story-meta">
            <span class="story-source">${story.site_name}</span>
            <span class="story-date">${formatDate(story.timestamp)}</span>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

// Utility functions
function isValidUrl(string) {
  try {
    new URL(string);
    return string.startsWith('http://') || string.startsWith('https://');
  } catch (_) {
    return false;
  }
}

function showStatus(message, type) {
  const status = document.getElementById('url-status');
  status.textContent = message;
  status.className = `url-status ${type}`;
  status.style.display = 'block';
}

function formatDate(timestamp) {
  const date = new Date(timestamp);
  const now = new Date();
  const diffTime = Math.abs(now - date);
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  if (diffDays === 1) return 'Yesterday';
  if (diffDays < 7) return `${diffDays} days ago`;
  return date.toLocaleDateString();
}

function openArticle(url) {
  window.open(url, '_blank');
}

function showEmptyState() {
  document.getElementById('empty-state').style.display = 'block';
  document.querySelector('.news-grid').style.display = 'none';
  document.getElementById('secondary-stories-container').style.display = 'none';
}

function hideEmptyState() {
  document.getElementById('empty-state').style.display = 'none';
  document.querySelector('.news-grid').style.display = 'grid';
  document.getElementById('secondary-stories-container').style.display = 'grid';
}

// Auto-refresh every 5 minutes
setInterval(loadNewsArticles, 5 * 60 * 1000);
</script>

<!-- Site scripts -->
<script src="script.js"></script>

<!-- Notification system -->
<script src="notifications.js"></script>

</body>
</html>