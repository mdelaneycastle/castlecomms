<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Staff Directory - Castle Comms</title>
  <link rel="icon" type="image/png" href="icon.png">
  
  <!-- Security Headers -->
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Last-Modified" content="Thu, 22 Aug 2025 09:59:56 GMT" />
  
  <link rel="stylesheet" href="style.css?v=20250822_095956_chatbot_cache_bust" />
  <style>
    .staff-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background: #F0EDE9;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(69, 73, 78, 0.12);
      color: var(--text-dark);
      min-height: auto;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      border: 1px solid rgba(216, 209, 197, 0.3);
    }

    .staff-container.expanded {
      min-height: 80vh;
    }


    .staff-content {
      position: relative;
      z-index: 2;
    }

    .staff-title {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 500;
      margin-bottom: 3rem;
      color: var(--secondary-color);
      font-family: var(--font-primary);
      letter-spacing: var(--letter-spacing-headers);
      animation: fadeInDown 0.8s ease-out;
    }

    .hierarchy-level {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 3rem;
      margin-bottom: 2rem;
    }

    .staff-member {
      position: relative;
      margin: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      transform: translateY(20px);
      opacity: 0;
      animation: slideInUp 0.6s ease-out forwards;
    }

    .staff-member.clickable:hover {
      transform: translateY(-10px) scale(1.05);
    }

    .staff-member.clickable:hover .staff-card::before {
      left: 100%;
    }

    .staff-member.clickable:hover .staff-photo {
      border-color: rgba(255,255,255,0.8);
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }


    .staff-card {
      background: white;
      border: 1px solid rgba(216, 209, 197, 0.3);
      border-radius: 20px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(69, 73, 78, 0.08);
    }



    .staff-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      object-position: center top;
      border: 4px solid rgba(255,255,255,0.3);
      background: white;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    /* Specific positioning for Raksha's photo */
    .staff-photo[alt="Raksha Hercombe"] {
      object-position: center 20%;
    }



    .staff-name {
      font-size: 1.4rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--secondary-color);
      font-family: var(--font-primary);
      letter-spacing: var(--letter-spacing-headers);
    }

    .staff-title-role {
      font-size: 1rem;
      color: var(--tertiary-color);
      font-style: italic;
      font-family: var(--font-primary);
    }


    .connection-branch {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      gap: 2rem;
      margin-top: 1rem;
    }

    .subordinates {
      display: none;
      animation: slideDown 0.5s ease-out;
    }

    .subordinates.show {
      display: block;
    }


    .level-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 1rem 0;
      opacity: 0.9;
      text-align: center;
    }

    .back-button {
      background: #F0EDE9;
      color: var(--secondary-color);
      border: 1px solid rgba(216, 209, 197, 0.3);
      border-radius: 12px;
      padding: 0.5rem 1.5rem;
      font-size: 0.9rem;
      font-family: var(--font-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(69, 73, 78, 0.08);
      display: none;
      position: absolute;
      top: 2rem;
      left: 2rem;
      z-index: 10;
    }

    .back-button.show {
      display: block;
    }

    .back-button:hover {
      background: white;
      border-color: rgba(216, 209, 197, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(69, 73, 78, 0.12);
    }

    .manager-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .manager-context {
      display: none;
      animation: slideDown 0.5s ease-out;
    }

    .manager-context.show {
      display: block;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInUp {
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }


    .staff-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 0.6rem;
      margin: 1rem 0 2rem 0;
      flex-wrap: nowrap;
    }

    .action-btn {
      background: #F0EDE9;
      color: var(--secondary-color);
      border: 1px solid rgba(216, 209, 197, 0.3);
      border-radius: 12px;
      padding: 0.5rem 0.8rem;
      font-size: 0.75rem;
      font-weight: 500;
      font-family: var(--font-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(69, 73, 78, 0.08);
      text-decoration: none;
      display: inline-block;
      text-align: center;
      white-space: normal;
      min-width: 90px;
      flex: 1;
      line-height: 1.2;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .action-btn:hover {
      background: white;
      border-color: rgba(216, 209, 197, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(69, 73, 78, 0.12);
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: #F0EDE9;
      color: var(--secondary-color);
      border: 1px solid rgba(216, 209, 197, 0.3);
      border-radius: 20px;
      padding: 2rem;
      max-width: 650px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(69, 73, 78, 0.12);
      position: relative;
      margin: 1rem;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: scale(1);
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      background: white;
      border: 1px solid rgba(216, 209, 197, 0.3);
      color: var(--secondary-color);
      font-size: 1.8rem;
      cursor: pointer;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(69, 73, 78, 0.08);
    }

    .modal-close:hover {
      background: var(--primary-color);
      transform: rotate(90deg);
      box-shadow: 0 6px 16px rgba(69, 73, 78, 0.12);
    }

    .modal-title {
      font-size: 2rem;
      font-weight: 500;
      font-family: var(--font-primary);
      letter-spacing: var(--letter-spacing-headers);
      color: var(--secondary-color);
      margin-bottom: 1.5rem;
      text-align: center;
      border-bottom: 1px solid rgba(216, 209, 197, 0.3);
      padding-bottom: 1rem;
    }

    .modal-section {
      margin-bottom: 1.5rem;
    }

    .modal-section h3 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: rgba(255,255,255,0.95);
      border-left: 4px solid rgba(255,255,255,0.4);
      padding-left: 1rem;
    }

    .modal-section p, .modal-section ul {
      line-height: 1.7;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .modal-section ul {
      padding-left: 1.5rem;
    }

    .modal-section li {
      margin-bottom: 0.5rem;
    }

    .contact-card {
      background: rgba(255,255,255,0.12);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.8rem;
      border-left: 4px solid rgba(255,255,255,0.4);
      transition: all 0.3s ease;
    }

    .contact-card:hover {
      background: rgba(255,255,255,0.18);
      transform: translateX(5px);
    }

    .contact-name {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
    }

    .contact-info {
      font-size: 0.95rem;
      opacity: 0.9;
      line-height: 1.4;
    }

    /* Email link styles */
    .copy-email {
      display: inline-block;
      margin-left: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      opacity: 0.7;
      transition: opacity 0.3s ease;
      text-decoration: none;
      color: inherit;
    }
    
    .copy-email:hover {
      opacity: 1;
      text-decoration: none;
    }

    @media screen and (max-width: 768px) {
      /* Mobile: Card-Based Vertical Navigation System */
      .staff-container {
        margin: 0.5rem;
        padding: 1rem;
        max-width: none;
        min-height: calc(100vh - 140px);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-light);
        padding-bottom: 6rem;
        position: relative;
        overflow: hidden;
      }
      
      .staff-container::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
        transform: rotate(45deg);
        animation: shimmer 4s infinite;
        z-index: 1;
      }
      
      .staff-content {
        position: relative;
        z-index: 2;
      }
      
      .staff-title {
        font-size: 1.6rem;
        margin-bottom: 1rem;
        text-align: center;
        color: white !important;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        background: none !important;
        -webkit-background-clip: initial !important;
        -webkit-text-fill-color: initial !important;
        background-clip: initial !important;
      }

      /* Mobile Navigation Header */
      .mobile-nav-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
      }

      .mobile-breadcrumb {
        flex: 1;
        font-size: 0.9rem;
        color: white;
        font-weight: 600;
        margin-right: 1rem;
      }

      .mobile-back-button {
        flex: 0 0 auto;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 0.6rem 1rem;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.4rem;
        transition: all 0.3s;
        backdrop-filter: blur(10px);
      }

      .mobile-back-button:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-1px);
        box-shadow: var(--shadow-light);
      }

      .mobile-back-button:disabled {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.6;
      }

      /* Hide desktop hierarchy completely */
      .hierarchy-level,
      .connection-branches,
      .connection-branch,
      .staff-member,
      .staff-card,
      .staff-grid,
      .back-button {
        display: none !important;
      }

      /* Mobile Staff Grid */
      .mobile-staff-container {
        display: block;
      }
      
      .mobile-staff-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .mobile-staff-card {
        padding: 1.25rem;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: var(--shadow-light);
        transition: all 0.3s;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 1rem;
        position: relative;
      }
      
      .mobile-staff-card:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: var(--shadow-medium);
        transform: translateY(-2px);
      }

      .mobile-staff-card.has-team::after {
        content: '›';
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.5rem;
        color: white;
        font-weight: bold;
        opacity: 0.8;
      }

      .mobile-staff-photo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        object-position: center top;
        border: 3px solid rgba(255, 255, 255, 0.3);
        background: white;
        flex-shrink: 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .mobile-staff-info {
        flex: 1;
        text-align: left;
        min-width: 0;
      }

      .mobile-staff-name {
        font-size: 1.1rem;
        color: white;
        font-weight: 600;
        margin-bottom: 0.25rem;
        line-height: 1.3;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .mobile-staff-title {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 0.5rem;
        font-weight: 500;
        line-height: 1.3;
      }

      .mobile-team-count {
        font-size: 0.8rem;
        color: white;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.2rem 0.5rem;
        border-radius: 12px;
        display: inline-block;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .mobile-staff-name.clickable {
        cursor: pointer;
        transition: opacity 0.3s ease;
      }
      
      .mobile-staff-name.clickable:hover {
        opacity: 0.8;
      }
      
      .mobile-copy-success {
        color: #4ade80 !important;
        font-weight: bold;
      }

      /* Section Headers */
      .mobile-section-header {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2c3e50;
        margin: 2rem 0 1rem 0;
        padding: 0.75rem;
        background: rgba(248, 249, 250, 0.8);
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .mobile-section-header:first-of-type {
        margin-top: 0;
      }

      /* Bottom navigation for easy access */
      .mobile-bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(15px);
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        padding: 0.75rem 1rem;
        box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        display: flex;
        justify-content: center;
        gap: 1rem;
      }

      .mobile-nav-btn {
        flex: 1;
        max-width: 150px;
        padding: 0.75rem 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        white-space: nowrap;
        backdrop-filter: blur(10px);
      }

      .mobile-nav-btn:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-light);
        border-color: rgba(255, 255, 255, 0.4);
      }

      /* Loading and Error States */
      .mobile-loading {
        text-align: center;
        padding: 3rem 1rem;
        color: #6c757d;
        font-size: 1rem;
      }

      .mobile-error {
        text-align: center;
        padding: 2rem 1rem;
        color: #dc3545;
        background: rgba(220, 53, 69, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(220, 53, 69, 0.2);
      }

      /* Modal optimizations for mobile */
      .modal-content {
        margin: 0.5rem;
        padding: 1.25rem;
        max-height: 95vh;
        border-radius: 12px;
        overflow-y: auto;
        background: rgba(255, 255, 255, 0.98) !important;
        color: #2c3e50 !important;
      }
      
      .modal-title {
        font-size: 1.4rem;
        margin-bottom: 1rem;
        text-align: center;
        color: #2c3e50 !important;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 35px;
        height: 35px;
        font-size: 1.2rem;
        background: rgba(220, 53, 69, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .modal-close:hover {
        background: #dc3545;
        transform: scale(1.1);
      }
    }

    /* Address Book Styles */
    .address-book-section {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
    }

    .address-book-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      font-family: var(--font-primary);
    }

    .address-book-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* Address Book Modal */
    .address-book-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .address-book-modal-content {
      background: #F0EDE9;
      margin: 2% auto;
      padding: 0;
      border-radius: 20px;
      width: min(95%, 1200px);
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
      border: 1px solid rgba(216, 209, 197, 0.3);
    }

    .address-book-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2rem 2rem 1rem;
      border-bottom: 1px solid rgba(216, 209, 197, 0.3);
    }

    .address-book-modal-header h2 {
      margin: 0;
      font-size: 2rem;
      color: var(--secondary-color);
      font-family: var(--font-primary);
    }

    .address-book-close {
      color: var(--tertiary-color);
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .address-book-close:hover {
      color: var(--secondary-color);
      background: rgba(216, 209, 197, 0.2);
    }

    .address-book-modal-body {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 700px;
    }

    /* Rolodex Styles - adapted for modal */
    .modal-app {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      height: 100%;
    }

    .modal-search-top {
      margin-bottom: 2rem;
      width: 100%;
      max-width: 500px;
    }

    .modal-search-top label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--secondary-color);
    }

    .modal-search-top input {
      width: 100%;
      padding: 1rem;
      border: 2px solid rgba(216, 209, 197, 0.5);
      border-radius: 12px;
      font-size: 1rem;
      background: white;
      color: var(--text-dark);
      font-family: var(--font-primary);
    }

    .modal-search-top input:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Rolodex container */
    .modal-stage-wrap {
      position: relative;
      min-height: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      flex: 1;
    }

    .modal-rolodex {
      position: relative;
      width: 520px;
      height: 320px;
      perspective: 1000px;
      margin: 2rem 0;
    }

    .modal-index {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem;
      color: var(--tertiary-color);
      font-weight: 600;
    }

    .modal-spindle {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 4px;
      height: 100%;
      background: var(--secondary-color);
      z-index: 1;
    }

    .modal-knob {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 10;
    }

    .modal-knob:hover {
      background: var(--tertiary-color);
      transform: translateY(-50%) scale(1.1);
    }

    .modal-knob.left { left: -80px; }
    .modal-knob.right { right: -80px; }

    .modal-knob button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .modal-ring {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.5s ease;
    }

    .modal-card {
      position: absolute;
      width: 520px;
      height: 280px;
      background: #e5ddcb;
      border: 1px solid rgba(216, 209, 197, 0.5);
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(69, 73, 78, 0.15);
      backface-visibility: hidden;
      transform-origin: center center;
    }

    .modal-card h3 {
      margin: 0 0 1rem 0;
      font-size: 1.8rem;
      color: var(--secondary-color);
      font-family: var(--font-primary);
    }

    .modal-card .tag {
      background: var(--secondary-color);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8rem;
      margin-bottom: 1rem;
      display: inline-block;
    }

    .modal-card .company {
      font-weight: 600;
      color: var(--tertiary-color);
      margin-bottom: 1rem;
    }

    .modal-card .contact-info div {
      margin: 0.5rem 0;
      color: var(--text-dark);
    }

    .modal-controls {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .modal-circle-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--secondary-color);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .modal-circle-btn:hover {
      background: var(--tertiary-color);
      transform: scale(1.1);
    }

    .modal-controls-bottom {
      margin-top: auto;
      padding: 1rem 0;
    }

    .modal-add-contact-btn {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    .modal-add-contact-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    /* Contact Form Modal inside Address Book Modal */
    .contact-form-modal {
      display: none;
      position: fixed;
      z-index: 2001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }

    .contact-form-modal-content {
      background: #F0EDE9;
      margin: 10% auto;
      padding: 0;
      border-radius: 16px;
      width: min(480px, 90%);
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      position: relative;
      border: 1px solid rgba(216, 209, 197, 0.3);
    }

    .contact-form-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid rgba(216, 209, 197, 0.3);
    }

    .contact-form-modal-header h3 {
      margin: 0;
      font-size: 1.5rem;
      color: var(--secondary-color);
    }

    .contact-form-close {
      color: var(--tertiary-color);
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .contact-form-close:hover {
      color: var(--secondary-color);
      background: rgba(216, 209, 197, 0.2);
    }

    .contact-form-modal form {
      padding: 2rem;
    }

    .contact-form-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .contact-form-label {
      font-weight: 600;
      color: var(--secondary-color);
      font-size: 1rem;
    }

    .contact-form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid rgba(216, 209, 197, 0.5);
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      background: white;
      color: var(--text-dark);
      transition: border-color 0.3s;
      box-sizing: border-box;
    }

    .contact-form-input:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .contact-form-actions {
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      margin-top: 2rem;
    }

    .contact-form-actions button {
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
    }

    .contact-form-actions button[type="submit"] {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      flex: 1;
    }

    .contact-form-actions button[type="submit"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }

    .contact-form-actions .danger {
      background: #dc3545;
      color: white;
    }

    .contact-form-actions .danger:hover {
      background: #c82333;
    }

    .tiny {
      font-size: 0.8rem;
      color: var(--tertiary-color);
    }

    @media (max-width: 768px) {
      .address-book-modal-content {
        width: 95%;
        margin: 1% auto;
      }

      .modal-rolodex {
        width: 300px;
        height: 200px;
      }

      .modal-card {
        width: 300px;
        height: 180px;
        padding: 1rem;
      }

      .modal-card h3 {
        font-size: 1.4rem;
      }

      .modal-knob.left { left: -50px; }
      .modal-knob.right { right: -50px; }
    }
  </style>
</head>
<body>

<!-- Background Slideshow -->
<div class="background-slideshow" id="background-slideshow">
  <!-- Images will be injected by JavaScript -->
</div>
  
<div id="header-container"></div>

<div id="sidebar-container"></div>
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<main id="main">
  <div class="staff-container">
    <button class="back-button" id="back-button" onclick="goBack()">← Back</button>
    <div class="staff-content">
      <h1 class="staff-title" id="staff-title">Spitfire Staff</h1>
      
      <!-- Address Book Button -->
      <div class="address-book-section">
        <button id="openAddressBookBtn" class="address-book-btn">
          📞 Address Book
        </button>
      </div>
      
      <!-- Mobile Card-Based Navigation (Only visible on mobile) -->
      <div class="mobile-staff-container" id="mobile-staff-container" style="display: none;">
        <div class="mobile-nav-header" id="mobile-nav-header" style="display: none;">
          <div class="mobile-breadcrumb" id="mobile-breadcrumb">Spitfire Staff</div>
          <button class="mobile-back-button" id="mobile-back-button" onclick="mobileGoBack()">
            ← Back
          </button>
        </div>
        
        <div class="mobile-staff-grid" id="mobile-staff-grid">
          <div class="mobile-loading">Loading staff directory...</div>
        </div>
      </div>
      
      <!-- Bottom Navigation (Mobile Only) -->
      <div class="mobile-bottom-nav" id="mobile-bottom-nav" style="display: none;">
        <button class="mobile-nav-btn" onclick="mobileShowAll()">
          🏠 Show All Staff
        </button>
      </div>
      
      <!-- Top Level Leadership -->
      <div class="hierarchy-level">
        <div class="staff-member clickable" data-staff="gary-turpin" style="animation-delay: 0.1s">
          <div class="staff-card">
            <img src="staff/Gary Turpin - Head of Operations Updated.jpg" alt="Gary Turpin" class="staff-photo" />
            <div class="staff-name">Gary Turpin <a href="mailto:gturpin@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
            <div class="staff-title-role">Head of Operations</div>
            <div class="expand-indicator">▼</div>
          </div>
        </div>
        
        <div class="staff-member clickable" data-staff="matt-king" style="animation-delay: 0.2s">
          <div class="staff-card">
            <img src="staff/Matt King - Head Of Inventory.jpg" alt="Matt King" class="staff-photo" />
            <div class="staff-name">Matt King <a href="mailto:mking@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
            <div class="staff-title-role">Head Of Inventory</div>
            <div class="expand-indicator">▼</div>
          </div>
        </div>
      </div>

      <!-- Gary Turpin's Direct Reports -->
      <div class="subordinates" id="gary-turpin-subordinates">
        <div class="manager-context" id="gary-turpin-context">
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 0.1s">
              <div class="staff-card">
                <img src="staff/Gary Turpin - Head of Operations Updated.jpg" alt="Gary Turpin" class="staff-photo" />
                <div class="staff-name">Gary Turpin</div>
                <div class="staff-title-role">Head of Operations</div>
              </div>
            </div>
          </div>
        </div>
        <div class="connection-branch">
          <div class="staff-member clickable" data-staff="martin-harrison" style="animation-delay: 0.3s">
            <div class="staff-card">
              <img src="staff/Martin Harrison - Head of Manufacturing and QC.jpg" alt="Martin Harrison" class="staff-photo" />
              <div class="staff-name">Martin Harrison</div>
              <div class="staff-title-role">Head of Manufacturing and QC</div>
            </div>
          </div>
        </div>
        
        <div class="connection-branch">
          <div class="staff-member clickable" data-staff="paul-chapman" style="animation-delay: 0.4s">
            <div class="staff-card">
              <img src="staff/Order Processing/Chappie.jpg" alt="Paul Chapman" class="staff-photo" />
              <div class="staff-name">Paul Chapman</div>
              <div class="staff-title-role">Client Order Fulfilment Team Manager</div>
            </div>
          </div>
          
          <div class="staff-member clickable" data-staff="stuart-whitehouse" style="animation-delay: 0.5s">
            <div class="staff-card">
              <img src="staff/Stuart Whitehouse - Logistics Manager.jpg" alt="Stuart Whitehouse" class="staff-photo" />
              <div class="staff-name">Stuart Whitehouse</div>
              <div class="staff-title-role">Logistics Manager</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Matt King's Direct Reports -->
      <div class="subordinates" id="matt-king-subordinates">
        <div class="manager-context" id="matt-king-context">
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 0.2s">
              <div class="staff-card">
                <img src="staff/Matt King - Head Of Inventory.jpg" alt="Matt King" class="staff-photo" />
                <div class="staff-name">Matt King <a href="mailto:mking@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
                <div class="staff-title-role">Head Of Inventory</div>
              </div>
            </div>
          </div>
        </div>
        <div class="connection-branch">
          <div class="staff-member clickable" data-staff="martin-sumner" style="animation-delay: 0.6s">
            <div class="staff-card">
              <img src="staff/Martin Sumner - Head Of Stock Control.jpg" alt="Martin Sumner" class="staff-photo" />
              <div class="staff-name">Martin Sumner <a href="mailto:msumner@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Head Of Stock Control</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 0.7s">
            <div class="staff-card">
              <img src="staff/Raksha Hercombe - Halcyon Support Manager.jpg" alt="Raksha Hercombe" class="staff-photo" />
              <div class="staff-name">Raksha Hercombe <a href="mailto:rhercombe@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Halcyon Support Manager</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 0.8s">
            <div class="staff-card">
              <img src="staff/Alexandra Bradley - Originals Admin.jpg" alt="Alexandra Bradley" class="staff-photo" />
              <div class="staff-name">Alexandra Bradley <a href="mailto:abradley@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Originals Admin</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Paul Chapman's Team -->
      <div class="subordinates" id="paul-chapman-subordinates">
        <div class="manager-context" id="paul-chapman-context">
          <!-- Order Processing Action Buttons -->
          <div class="action-buttons">
            <button class="action-btn" onclick="openModal('roles-modal')">Roles & Responsibilities</button>
            <a href="https://view.pagetiger.com/ibmxza/ReturningPieces.pdf" target="_blank" class="action-btn">Returning Artwork</a>
            <button class="action-btn" onclick="openModal('instructions-modal')">Gallery Instructions</button>
            <a href="https://view.pagetiger.com/ibmxza/ItemStatusesGuide.pdf" target="_blank" class="action-btn">Item Status Meanings</a>
            <a href="https://view.pagetiger.com/ibmxza/OrderFlowChart2023.pdf" target="_blank" class="action-btn">Production Flow Chart</a>
          </div>
          
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 0.3s">
              <div class="staff-card">
                <img src="staff/Order Processing/Chappie.jpg" alt="Paul Chapman" class="staff-photo" />
                <div class="staff-name">Paul Chapman <a href="mailto:pchapman@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
                <div class="staff-title-role">Client Order Fulfilment Team Manager</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="staff-grid">
          <div class="staff-member" style="animation-delay: 0.9s">
            <div class="staff-card">
              <img src="staff/Order Processing/Jenny.jpg" alt="Jenny Durrant" class="staff-photo" />
              <div class="staff-name">Jenny Durrant <a href="mailto:jdurrant@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Client Order Fulfilment Supervisor</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 1.0s">
            <div class="staff-card">
              <img src="staff/Order Processing/Gerald.jpg" alt="Gerald Hooper" class="staff-photo" />
              <div class="staff-name">Gerald Hooper <a href="mailto:ghooper@castlegalleries.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Senior Client Order Fulfilment Coordinator</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 1.1s">
            <div class="staff-card">
              <img src="staff/Order Processing/Katie.jpg" alt="Katie Lewis" class="staff-photo" />
              <div class="staff-name">Katie Lewis <a href="mailto:klewis@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Client Order Fulfilment Administration Coordinator</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 1.2s">
            <div class="staff-card">
              <img src="staff/Order Processing/Tara.jpg" alt="Tara Platts" class="staff-photo" />
              <div class="staff-name">Tara Platts <a href="mailto:tplatts@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Client Order Fulfilment Coordinator</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 1.3s">
            <div class="staff-card">
              <img src="staff/Order Processing/Pip.jpg" alt="Phillippa Beevor-Reid" class="staff-photo" />
              <div class="staff-name">Phillippa Beevor-Reid <a href="mailto:pbeevor-reid@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Client Order Fulfilment Coordinator</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 1.4s">
            <div class="staff-card">
              <img src="staff/Order Processing/Amelia.jpg" alt="Amelia Rush" class="staff-photo" />
              <div class="staff-name">Amelia Rush <a href="mailto:arush@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Client Order Fulfilment Coordinator</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stuart Whitehouse's Team -->
      <div class="subordinates" id="stuart-whitehouse-subordinates">
        <div class="manager-context" id="stuart-whitehouse-context">
          <!-- Logistics Action Buttons -->
          <div class="action-buttons">
            <button class="action-btn" onclick="openModal('retail-deliveries-modal')">Retail Deliveries</button>
            <button class="action-btn" onclick="openModal('personal-deliveries-modal')">Personal Deliveries</button>
            <button class="action-btn" onclick="openModal('installations-modal')">Installations</button>
            <button class="action-btn" onclick="openModal('client-viewings-modal')">Client Viewings</button>
          </div>
          
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 0.4s">
              <div class="staff-card">
                <img src="staff/Stuart Whitehouse - Logistics Manager.jpg" alt="Stuart Whitehouse" class="staff-photo" />
                <div class="staff-name">Stuart Whitehouse <a href="mailto:swhitehouse@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
                <div class="staff-title-role">Logistics Manager</div>
              </div>
            </div>
          </div>
        </div>
        <div class="staff-grid">
          <div class="staff-member" style="animation-delay: 1.5s">
            <div class="staff-card">
              <img src="staff/Nathan Smethurst - Shipping Supervisor.jpg" alt="Nathan Smethurst" class="staff-photo" />
              <div class="staff-name">Nathan Smethurst <a href="mailto:nsmethurst@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Shipping Supervisor</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 1.6s">
            <div class="staff-card">
              <img src="staff/Olly Clark - Packing Supervisor.jpg" alt="Olly Clark" class="staff-photo" />
              <div class="staff-name">Olly Clark <a href="mailto:oclark@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Packing Supervisor</div>
            </div>
          </div>
        </div>
        
        <!-- Centered Zara -->
        <div style="display: flex; justify-content: center; margin-top: 2rem;">
          <div class="staff-member" style="animation-delay: 1.7s">
            <div class="staff-card">
              <img src="staff/Zara Chaudhry - Logistics Admin Assistant.jpg" alt="Zara Chaudhry" class="staff-photo" />
              <div class="staff-name">Zara Chaudhry <a href="mailto:zchaudhry@washingtongren.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Logistics Admin Assistant</div>
            </div>
          </div>
        </div>
        
        <!-- Install Team Section -->
        <div style="text-align: center; margin-top: 3rem;">
          <div class="level-title">Install Team</div>
          <div style="display: flex; justify-content: center; margin-top: 1rem;">
            <img src="installteam.png" alt="Install Team" style="max-width: 300px; height: auto; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); border: 3px solid rgba(255,255,255,0.3);" />
          </div>
        </div>
      </div>

      <!-- Martin Harrison's Team -->
      <div class="subordinates" id="martin-harrison-subordinates">
        <div class="manager-context" id="martin-harrison-context">
          <!-- Manufacturing Action Buttons -->
          <div class="action-buttons">
            <button class="action-btn" onclick="openModal('framing-modal')">Framing</button>
            <button class="action-btn" onclick="openModal('mounting-modal')">Mounting</button>
            <button class="action-btn" onclick="openModal('quality-control-modal')">Quality Control</button>
            <a href="Requestform-MASTER2025.xlsx" target="_blank" class="action-btn">Requests</a>
            <button class="action-btn" onclick="openModal('handling-art-modal')">Handling Art</button>
          </div>
          
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 0.5s">
              <div class="staff-card">
                <img src="staff/Martin Harrison - Head of Manufacturing and QC.jpg" alt="Martin Harrison" class="staff-photo" />
                <div class="staff-name">Martin Harrison <a href="mailto:mharrison@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
                <div class="staff-title-role">Head of Manufacturing and QC</div>
              </div>
            </div>
          </div>
        </div>
        <div class="connection-branch">
          <div class="staff-member clickable" data-staff="gary-day" style="animation-delay: 1.8s">
            <div class="staff-card">
              <img src="staff/Gary Day - Framing Production Manager.jpg" alt="Gary Day" class="staff-photo" />
              <div class="staff-name">Gary Day <a href="mailto:gday@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Framing Production Manager</div>
            </div>
          </div>
        </div>
        
        <div class="connection-branch">
          <div class="staff-member" style="animation-delay: 1.9s">
            <div class="staff-card">
              <img src="staff/Tom Harrison - Senior Mounting Operative.jpg" alt="Tom Harrison" class="staff-photo" />
              <div class="staff-name">Tom Harrison <a href="mailto:tharrison@castlefineart.com" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Senior Mounting Operative</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 2.0s">
            <div class="staff-card">
              <img src="staff/Chrissy Hall - Quality Control Supervisor.jpg" alt="Chrissy Hall" class="staff-photo" />
              <div class="staff-name">Chrissy Hall <a href="mailto:chall@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Quality Control Supervisor</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Martin Sumner's Team -->
      <div class="subordinates" id="martin-sumner-subordinates">
        <div class="manager-context" id="martin-sumner-context">
          <!-- Stock Control Action Buttons -->
          <div class="action-buttons">
            <button class="action-btn" onclick="openModal('gallery-instructions-modal')">Gallery Instructions</button>
            <button class="action-btn" onclick="openModal('selling-priorities-modal')">Selling Priorities</button>
            <button class="action-btn" onclick="openModal('halcyon-stock-modal')">Halcyon Stock</button>
          </div>
          
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 0.6s">
              <div class="staff-card">
                <img src="staff/Martin Sumner - Head Of Stock Control.jpg" alt="Martin Sumner" class="staff-photo" />
                <div class="staff-name">Martin Sumner <a href="mailto:msumner@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
                <div class="staff-title-role">Head Of Stock Control</div>
              </div>
            </div>
          </div>
        </div>
        <div class="staff-grid">
          <div class="staff-member" style="animation-delay: 2.0s">
            <div class="staff-card">
              <img src="staff/Kerry Hinks - Stock Admin Manager.jpg" alt="Kerry Hinks" class="staff-photo" />
              <div class="staff-name">Kerry Hinks <a href="mailto:khinks@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Stock Admin Manager</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 2.1s">
            <div class="staff-card">
              <img src="staff/Adam Hercombe - Warehouse Stock Manager.jpg" alt="Adam Hercombe" class="staff-photo" />
              <div class="staff-name">Adam Hercombe <a href="mailto:ahercombe@washingtongreen.co.uk" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a></div>
              <div class="staff-title-role">Warehouse Stock Manager</div>
            </div>
          </div>
        </div>
        
        <!-- The Supervisors Section -->
        <div style="text-align: center; margin-top: 3rem;">
          <div class="level-title">The Supervisors</div>
          <div style="display: flex; justify-content: center; margin-top: 1rem;">
            <img src="Jessica Smith and Michael O'Cleary.png" alt="Jessica Smith and Michael O'Cleary" style="max-width: 200px; height: auto; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); border: 3px solid rgba(255,255,255,0.3);" />
          </div>
          <div style="color: rgba(255,255,255,0.9); margin-top: 1rem; font-size: 1.1rem; font-weight: 500;">
            Jessica Smith and Michael O'Cleary
          </div>
        </div>
      </div>

      <!-- Gary Day's Team -->
      <div class="subordinates" id="gary-day-subordinates">
        <div class="manager-context" id="gary-day-context">
          <div class="manager-header">
            <div class="staff-member" style="animation-delay: 1.8s">
              <div class="staff-card">
                <img src="staff/Gary Day - Framing Production Manager.jpg" alt="Gary Day" class="staff-photo" />
                <div class="staff-name">Gary Day</div>
                <div class="staff-title-role">Framing Production Manager</div>
              </div>
            </div>
          </div>
        </div>
        <div class="staff-grid">
          <div class="staff-member" style="animation-delay: 2.2s">
            <div class="staff-card">
              <img src="staff/Bill Chand - Framing Supervisor.jpg" alt="Bill Chand" class="staff-photo" />
              <div class="staff-name">Bill Chand</div>
              <div class="staff-title-role">Framing Supervisor</div>
            </div>
          </div>
          
          <div class="staff-member" style="animation-delay: 2.3s">
            <div class="staff-card">
              <img src="staff/Adam Hyde - Framing Supervisor (Cutting Room).jpg" alt="Adam Hyde" class="staff-photo" />
              <div class="staff-name">Adam Hyde</div>
              <div class="staff-title-role">Framing Supervisor (Cutting Room)</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modals -->
  <div class="modal-overlay" id="roles-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('roles-modal')">&times;</button>
      <div class="modal-title">Client Order Fulfilment Team</div>
      
      <div class="modal-section">
        <p>Please call your assigned coordinator if you need any information on the below:</p>
        <ul>
          <li>Chasing orders or query ETAs for clients</li>
          <li>Framing queries and quotes</li>
          <li>Track pending shipments with couriers</li>
          <li>Customer orders needed on your next van</li>
          <li>Collections from clients</li>
        </ul>
        <p>You can reach the team on <strong>coft@castlefineart.com</strong></p>
      </div>
      
    </div>
  </div>
  
  <div class="modal-overlay" id="instructions-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('instructions-modal')">&times;</button>
      <div class="modal-title">Gallery Instructions</div>
      
      <div class="modal-section">
        <p><strong>ITEM MARKED AS SOLD</strong> – Please make sure any orders sold from the gallery are marked as sold straight away. When item has been marked as sold, please update notes. If for any reason you cannot Mark As Sold, please contact the COFT team.</p>
      </div>
      
      <div class="modal-section">
        <p><strong>FRAMING CODES</strong> – Please make sure there is always a framing code on the order. If there are special instructions for a different frame code noted on the paperwork, please cross out the automated frame code that is on there and write the correct one on in its place. Please make the frame code chosen (especially if it is not the standard frame for the piece) <strong>bold and noticeable</strong>.</p>
      </div>
      
      <div class="modal-section">
        <p><strong>SPECIAL INSTRUCTIONS</strong> – Please make sure any special instructions are entered into the order in the box provided.</p>
      </div>
      
      <div class="modal-section">
        <p><strong>PRF FORMS</strong> – Please can you make sure there is a frame code on the PRF form and relevant instructions. Please use the correct PRF form and procedure.</p>
      </div>
      
      <div class="modal-section">
        <p><strong>RETURN OF STOCK FOR CUSTOMER ORDERS</strong> – When a request comes through to be returned to H/O, this must come back on the next available van delivery and wrapped in good condition.</p>
      </div>
      
      <div class="modal-section">
        <p><strong>LTD FRAMING ORDERS</strong> – When booking on these orders, please make sure in special instructions you add as much info as possible (artist, title, edition number, framing code). This will help us to locate orders when being chased.</p>
      </div>
      
      <div class="modal-section">
        <p><strong>ORDER PROCESSING EMAIL</strong> – Please send all enquiries to <strong>coft@castlefineart.com</strong></p>
      </div>
      
      <div class="modal-section">
        <h3>Sending Orders Together</h3>
        <p>We can't guarantee orders will be sent together unless the correct process is followed. This is something we can do on request, but as you can imagine the volume of orders coming through on a daily basis, this is very hard to manage and can easily be missed.</p>
        <p>Please can we ask that if you do have any requests for these, you put a DND date in and clearly state in the comments that you would like these orders to be sent together.</p>
      </div>
    </div>
  </div>
  
  <!-- Logistics Modals -->
  <div class="modal-overlay" id="retail-deliveries-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('retail-deliveries-modal')">&times;</button>
      <div class="modal-title">Gallery Deliveries</div>
      
      <div class="modal-section">
        <h3>Customer Deliveries</h3>
        <p>Galleries receive deliveries once a week on average, on delivery days:</p>
        <ul>
          <li>There should always be enough staff working to ensure that the gallery is covered and the delivery can be taken. Sometimes this may involve assisting with heavy items.</li>
          <li>Space must be created in the stock room so new pieces can be easily stored.</li>
          <li>Ensure that all items promised to other galleries or HO are wrapped and have a Product Return Form attached. It is the gallery team's responsibility to ensure that these go back on the van in a safe condition.</li>
          <li>Before the van driver leaves, one member of staff should take responsibility for checking that all items listed on the delivery note have been delivered.</li>
          <li>Each item should be checked for damage within 2 days of receipt, damages must be reported to Spitfire within this time period.</li>
        </ul>
      </div>
      
      <div class="modal-section">
        <h3>Shipping Costs</h3>
        <ul>
          <li>Free shipping in the UK</li>
          <li>Free shipping into USA</li>
          <li>£50.00 into Europe</li>
          <li>£120.00 Rest of the world</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="personal-deliveries-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('personal-deliveries-modal')">&times;</button>
      <div class="modal-title">Personal Deliveries (PD)</div>
      
      <div class="modal-section">
        <p>We may choose to deliver your client's order for a number of reasons despite the order not being processed for Personal Delivery. To name a few, geographical efficiency, if the art is too big to be couriered and if the art requires glass a priority.</p>
      </div>
      
      <div class="modal-section">
        <p>In this instance a driver will leave spitfire with a loaded van and hand deliver to the door of the client. The driver is also required to take a photo for proof of delivery.</p>
      </div>
      
      <div class="modal-section">
        <p>You can request specific Personal Deliveries by contacting - <strong>InstallationandPD@washingtongreen.co.uk</strong></p>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="installations-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('installations-modal')">&times;</button>
      <div class="modal-title">Installations</div>
      
      <div class="modal-section">
        <p>Installations must be charged at £250 unless authorised by your Regional Director. You may only offer a discount on the installation fee to clients who have purchased a piece over £10,000.</p>
      </div>
      
      <div class="modal-section">
        <p><a href="https://view.pagetiger.com/ibmxza/InstallationRequestFormexample.docx" target="_blank" style="color: #fff; text-decoration: underline;">Click here for an example of how to fill out the installation request form</a></p>
        <p><a href="https://view.pagetiger.com/ibmxza/InstallationRequestForm.docx" target="_blank" style="color: #fff; text-decoration: underline;">Click here for the installation request form</a></p>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="client-viewings-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('client-viewings-modal')">&times;</button>
      <div class="modal-title">Client Viewings / Home Approvals</div>
      
      <div class="modal-section">
        <p>This is a specific request from the gallery to assist sales staff with a client viewing at the home of the client.</p>
      </div>
      
      <div class="modal-section">
        <p>Often additional piece of stock or orders are required to be dealt with at the same time. We manage this by using Monday.com where the relevant team will be able to prepare the product.</p>
      </div>
      
      <div class="modal-section">
        <p>This request, much like that of an install needs to be requested via logistics - <strong>InstallationandPD@washingtongreen.co.uk</strong></p>
      </div>
      
      <div class="modal-section">
        <p>Like an install we need as much accurate information from you to be provided to the install operative to prepare for the job at hand.</p>
      </div>
      
      <div class="modal-section">
        <p>Occasionally if we are unable to support, you may need to make prior arrangements for travel.</p>
      </div>
    </div>
  </div>
  
  <!-- Manufacturing Modals -->
  <div class="modal-overlay" id="framing-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('framing-modal')">&times;</button>
      <div class="modal-title">Framing</div>
      
      <div class="modal-section">
        <p><strong>Some of the mouldings we use are very expensive and having to reframe due to handling damage is extremely costly.</strong></p>
        
        <h3>Glass Types</h3>
        <div class="glass-types">
          <div class="glass-type">
            <h4>Float Glass</h4>
            <p>This is the default glass, used in all our Signed Limited-Edition pieces as standard. It is a high quality 2mm thick glass, with typically up to 55% UV protection (note: not suitable for locations in direct light) and as with all float glass, it has a slight greenish hue or tint to it.</p>
          </div>
          
          <div class="glass-type">
            <h4>UV, AR/70</h4>
            <p>It looks exactly like the float glass, but it does give 70% UV light filtration, meaning that artwork will be protected better than with float glass from the damaging UV light. Along with AR (Anti Reflection) properties. It is made from low-iron water-white glass which gives an almost invisible quality with very little light reflection (only 1% of light is reflected).</p>
          </div>
          
          <div class="glass-type">
            <h4>Museum Glass - UV, AR/99</h4>
            <p>This is the ONLY glass we use that can be called museum glass. It is the only product we provide that has both full Conservation Grade UV Protection and the anti-reflection for picture clarity. It does give 99% UV light filtration.</p>
          </div>
          
          <div class="glass-type">
            <h4>Art Screen</h4>
            <p>This is the product we use for couriering pieces around the UK and all over the world. We always must use Art Screen in place of glass for courier deliveries, because of the high risk the glass will break in transit damaging the artwork.</p>
          </div>
          
          <div class="glass-type">
            <h4>Museum Art Screen</h4>
            <p>This product is only available upon request and authorization through the Head of Operations. This is the most premium product we use and is extremely expensive. It has all the properties and more of museum glass, as an Art Screen.</p>
          </div>
          
          <div class="glass-type">
            <h4>Glass / Art Screen Thickness</h4>
            <p>All glass / art screen come in a variety of thicknesses. Typically 2mm - 4mm which is quoted dependent on the size of the art.</p>
          </div>
        </div>

        <h3>UV Light and Damage</h3>
        <p>Ultraviolet light (UV) is electromagnetic radiation with wavelengths shorter than visible light but longer than x-rays. So called because it lies directly beyond the violet section of visible light. UV can cause damage to a wide range of materials. UV is present in all daylight, with direct sunlight and clear blue sky having particularly high levels. Many artificial light sources emit UV too. Particularly bad are fluorescents, tungsten-halogen lamps, and HID lamps. Regular incandescent bulbs and fiber-optics are safe. All artwork is at risk but artwork and will be dependent upon where the customer intends to hang the artwork as to how much exposure to UV light the artwork will receive.</p>

        <h3>Anti-reflection</h3>
        <p>The advanced coatings on both Tru Vue products greatly reduce visible light reflection down to 1% or less. This means it allows 99% of visible light through the glass and the result is stunning clarity and color accuracy. Almost invisible in good, controlled lighting conditions, they really show-off the artwork which is why this glass is now used on many original artworks we sell. Because it does not have a greenish tint it is particularly effective with artwork with lots of black in the image or that use black mount.</p>

        <h3>Cleaning and Maintenance of Glass</h3>
        <p>There are a few things to remember when cleaning the glass on our artwork. These are to help maintain the glass and the frame along with making the image look the best it can to help with a sale.</p>
        <ul>
          <li>Never use any abrasive or ammonia-based cleaning fluids</li>
          <li>Regular cleaners such as Nil glass, G&M Glass Cleaner etc. are fine - but it can take 2 or 3 tries to get a coated glass clean</li>
          <li>Best of all are the evaporative cleaners such as 'Optibrite'</li>
          <li>Use a soft, clean, lint-free cloth, preferably a modern micro-fiber one</li>
          <li>Have dedicated cleaning cloths for your coated glass – and keep them clean</li>
          <li><strong>NEVER</strong> spray any water or cleaner directly on to the glass as this can run down the glass and inside the frame causing damage. It is always better to apply any fluid to the cloth first.</li>
        </ul>
        <p><strong>N.B.</strong> Remember it is good customer service to advise your customers about these cleaning 'tips'</p>

        <h3>Complex Builds</h3>
        <p>The framing process used for Richard Rowan style originals or limited edition prints on glass is very different to standard framing. These are hand-crafted products made to exacting specifications. It typically takes 3-4 times longer to frame them and many more materials are used than with a normal picture they are therefore considerably more expensive to produce.</p>
        
        <p>Because of the unique way that these pictures are manufactured, most of the product has to be destroyed if the glass needs to be removed and reframing these products is very expensive.</p>
        
        <p><strong>We need to take the utmost care not to damage them during handling and ensure that they are wrapped properly to prevent damage in transit or storage.</strong></p>

        <h3>The Assembly Process</h3>
        <div style="text-align: center; margin: 1rem 0;">
          <img src="TheAssemblyProcess.png" alt="The Assembly Process Diagram" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
        </div>
        <ol>
          <li>The artwork <strong>(1)</strong> is painted or printed onto the rear face of British Standard certified toughened glass <strong>(2)</strong>. Toughened glass is used to improve safety and the durability of the artwork. The glass is 4mm thick, twice the thickness of standard float glass and accounts for the increased weight associated with this type of product.</li>
          
          <li>A double rebate frame moulding <strong>(3)</strong> is required to enable a space to be generated behind the artwork creating a floated effect. These mouldings are quite specialised and consequently there are very few to select from. The wood used is relatively soft and is particularly easy to mark or dent. <strong>Extreme care must be used at all times when handling this type of artwork to avoid damage.</strong> The frame is mitre cut to suit the size of the glass artwork, and pinned and glued in the conventional way.</li>
          
          <li>Thick card packer strips <strong>(4)</strong> are cut to size and securely attached to the frame moulding to retain the glass in place. A very strong bond is required between the packer strips and frame moulding in order to hold the heavy glass in place. This is achieved by applying a specialist double sided tape <strong>(5)</strong> to the packer and for extra security, stapling <strong>(6)</strong> in place.</li>
          
          <li>A decorative hayseed mount board card strip <strong>(7)</strong> is attached to the packer with double sided tape <strong>(8)</strong> to form a visible interior edge. This decorative strip is cut on a Zünd computer controlled 3-axis mount cutter to an accuracy of ± 0.1mm, to achieve high quality tight joints. <strong>If at any stage the artwork needs to be removed for example to reframe, items 4 through to 8 have to be destroyed in order to access the glass.</strong></li>
          
          <li>A decorative hayseed mount board back <strong>(9)</strong> is cut and pinned into the frame moulding using framer's points <strong>(10)</strong>. This creates the back of the visible interior. An MDF back board <strong>(11)</strong> closes off the assembly and is again secured to the frame moulding again using framer's points <strong>(12)</strong>. Framing tape <strong>(13)</strong> is used to finish off the back neatly and seal the interior. Finally, the frame is strung in the conventional way or hanging brackets are used for larger pieces.</li>
        </ol>

        <h3>'Viewing Windows' in Originals</h3>
        <p>As an additional feature many originals have a viewing window introduced to the rear so that our customers can see the back of the picture, which in itself is a piece of art. Perspex is used in lieu of glass for the viewing window because glass may break when contacted by the picture hooks during hanging. Because Perspex scratches easily, a layer of protective blue film is placed over the area most likely to come in contact with the picture hooks. An unprotected area is always left at the bottom so you can demonstrate to the customer the effect of the viewing window. <strong>The protective film must not be removed in the gallery; it is designed for the customer to remove themselves once safely home.</strong></p>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="mounting-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('mounting-modal')">&times;</button>
      <div class="modal-title">Mounting</div>
      
      <div class="modal-section">
        <p>There are many mount styles used to present our paper prints. Each method we use requires dedication and care to protect the artwork. All of the materials used are of the highest standard. From double mounts to deep bevel mounts, to float-mounted methods, every effort goes in to make sure the process is completely reversible, allowing the image to be removed at any time, completely undamaged.</p>
        
        <h3>Materials and Standards</h3>
        <ul>
          <li><strong>PH Neutral and Acid Free:</strong> All products that come into contact with the paper print are PH neutral and acid free</li>
          <li><strong>Archival Tapes:</strong> We use archival tapes that are completely reversible and acid free</li>
          <li><strong>Clear Corner Pockets:</strong> Used to place the imagery within the mount</li>
          <li><strong>Conservation Standard Mountboards:</strong> All our mountboards are conservation standard and have a life expectancy of 200 years</li>
        </ul>
        
        <h3>Mount Styles</h3>
        <div class="mount-styles">
          <div class="mount-style">
            <h4>Double Mounts</h4>
            <p>Professional layered mounting technique for enhanced presentation</p>
          </div>
          
          <div class="mount-style">
            <h4>Deep Bevel Mounts</h4>
            <p>Creates depth and shadow effects for dramatic presentation</p>
          </div>
          
          <div class="mount-style">
            <h4>Float-Mounted Methods</h4>
            <p>Artwork appears to float within the frame, showing the full paper edges</p>
          </div>
        </div>
        
        <div class="key-principle">
          <h3>Key Principle: Complete Reversibility</h3>
          <p><strong>Every effort goes into making sure the process is completely reversible, allowing the image to be removed at any time, completely undamaged.</strong></p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="quality-control-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('quality-control-modal')">&times;</button>
      <div class="modal-title">Quality Control</div>
      
      <div class="modal-section">
        <p>Quality Control information will be displayed here.</p>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="requests-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('requests-modal')">&times;</button>
      <div class="modal-title">Requests</div>
      
      <div class="modal-section">
        <p>Requests information will be displayed here.</p>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="handling-art-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('handling-art-modal')">&times;</button>
      <div class="modal-title">Handling Art</div>
      
      <div class="modal-section">
        <p><strong>Handling artwork properly is essential to ensure its preservation and prevent costly damage during storage, transit, and display.</strong></p>
        
        <h3>General Handling Principles</h3>
        <ul>
          <li><strong>Clean Hands:</strong> Always ensure hands are clean and dry before handling any artwork</li>
          <li><strong>Two-Person Rule:</strong> Large or valuable pieces should always be handled by two people</li>
          <li><strong>Proper Lifting:</strong> Lift from the bottom and support the sides - never lift by the frame edges alone</li>
          <li><strong>Face Protection:</strong> Keep artwork facing away from your body to avoid contact</li>
          <li><strong>Clear Pathways:</strong> Ensure all routes are clear before moving artwork</li>
        </ul>
        
        <h3>Storage Requirements</h3>
        <ul>
          <li><strong>Vertical Storage:</strong> Store framed pieces vertically in purpose-built racks</li>
          <li><strong>Spacing:</strong> Allow adequate space between pieces to prevent contact</li>
          <li><strong>Environmental Control:</strong> Maintain stable temperature and humidity levels</li>
          <li><strong>Protection:</strong> Use appropriate coverings to protect from dust and light</li>
          <li><strong>Access:</strong> Ensure easy access without having to move multiple pieces</li>
        </ul>
        
        <h3>Transportation Guidelines</h3>
        <ul>
          <li><strong>Protective Packaging:</strong> Use appropriate wrapping materials for each piece</li>
          <li><strong>Secure Loading:</strong> Ensure artwork cannot move during transport</li>
          <li><strong>Climate Considerations:</strong> Account for temperature and humidity changes</li>
          <li><strong>Route Planning:</strong> Choose routes that minimize vibration and sudden movements</li>
          <li><strong>Insurance Coverage:</strong> Ensure appropriate insurance is in place</li>
        </ul>
        
        <h3>Canvas Wrapping Procedures</h3>
        <p>For detailed canvas wrapping training, please watch our comprehensive video guide:</p>
        <p><a href="https://www.youtube.com/watch?v=YourVideoID" target="_blank" style="color: #fff; text-decoration: underline;">Canvas Wrapping Training Video</a></p>
        
        <h3>Specialised Wrapping Techniques</h3>
        <p>For complex or high-value pieces, refer to our detailed wrapping procedures:</p>
        <p><a href="SpecialisedWrapping.pdf" target="_blank" style="color: #fff; text-decoration: underline;">Download Specialised Wrapping Guide (PDF)</a></p>
        
        <h3>Damage Assessment and Reporting</h3>
        <p>If artwork is damaged, follow our standardised assessment procedures:</p>
        <p><a href="Damaged Artwork Instruction.docx" target="_blank" style="color: #fff; text-decoration: underline;">Download Damaged Artwork Instructions (DOCX)</a></p>
        
        <h3>Emergency Procedures</h3>
        <ul>
          <li><strong>Immediate Assessment:</strong> Quickly assess the extent of any damage</li>
          <li><strong>Documentation:</strong> Photograph damage from multiple angles</li>
          <li><strong>Isolation:</strong> Separate damaged pieces from undamaged artwork</li>
          <li><strong>Expert Consultation:</strong> Contact conservation specialists for valuable pieces</li>
          <li><strong>Insurance Notification:</strong> Report damage to insurance providers promptly</li>
        </ul>
        
        <h3>Staff Training Requirements</h3>
        <p>All staff involved in artwork handling must:</p>
        <ul>
          <li>Complete initial handling training within their first month</li>
          <li>Receive annual refresher training</li>
          <li>Demonstrate competency with different artwork types</li>
          <li>Understand emergency procedures</li>
          <li>Follow all safety protocols consistently</li>
        </ul>
        
        <h3>Quality Assurance</h3>
        <p>Regular audits ensure our handling standards are maintained:</p>
        <ul>
          <li><strong>Procedure Reviews:</strong> Monthly review of handling procedures</li>
          <li><strong>Equipment Checks:</strong> Regular inspection of handling equipment</li>
          <li><strong>Staff Assessment:</strong> Periodic evaluation of staff techniques</li>
          <li><strong>Incident Analysis:</strong> Investigation of any handling incidents</li>
          <li><strong>Continuous Improvement:</strong> Updates based on best practices</li>
        </ul>
      </div>
    </div>
  </div>
  
  <!-- Stock Control Modals -->
  <div class="modal-overlay" id="gallery-instructions-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('gallery-instructions-modal')">&times;</button>
      <div class="modal-title">Gallery Instructions</div>
      
      <div class="modal-section">
        <h3>Must Sell by Correct Edition Number</h3>
        <p>Please make sure you sell items from your gallery using the correct edition number, this is imperative with the new system we have in place.</p>
      </div>
      
      <div class="modal-section">
        <h3>Report Any Stock Anomalies</h3>
        <p>Please report any items you have that are either incorrect by title or edition number, the stock team can correct this.</p>
        <p>Email the team: <strong>stockcontrol@castlefineart.com</strong></p>
      </div>
      
      <div class="modal-section">
        <h3>Damages/Thefts</h3>
        <p>Please make sure you advise us of any damages whether it has arrived in this condition or has happened in the gallery. Report all thefts and we require a CRN from the Police.</p>
      </div>
      
      <div class="modal-section">
        <h3>Repairs</h3>
        <p>Please contact us for any items that can be repaired, send as much information to:</p>
        <ul>
          <li><strong>ahercombe@washingtongreen.co.uk</strong></li>
          <li><strong>jsmith@washingtongreen.co.uk</strong></li>
        </ul>
      </div>
      
      <div class="modal-section">
        <h3>PRF Forms</h3>
        <p>Please make sure there are clear transfer instructions of destinations or contact names.</p>
      </div>
      
      <div class="modal-section">
        <h3>TITU's</h3>
        <p>CG.NET has a drop down for trade in trade up. Please send back all trade-ins FAO Adam Hercombe and Michael O'Cleary once approved by James Shepherd.</p>
        <p>Please supply as much information as possible to:</p>
        <ul>
          <li><strong>ahercombe@washingtongreen.co.uk</strong></li>
          <li><strong>mocleary@washingtongreen.co.uk</strong></li>
        </ul>
      </div>
      
      <div class="modal-section">
        <h3>Stock Transfers</h3>
        <p>Please report any stock transfers that are not via the usual delivery schedule i.e. RAM movement.</p>
      </div>
      
      <div class="modal-section">
        <h3>Stock Replenishment or Requests</h3>
        <p>Please contact us for any stock requirements, replacements or client viewings for SLE/SCU/ORI's. You will receive an email back stating whether it can or cannot be provided.</p>
        <p>Please request via Adam Hercombe: <strong>ahercombe@washingtongreen.co.uk</strong></p>
        <p>Or call the stock team on <strong>01213848139</strong></p>
      </div>
      
      <div style="text-align: center; margin: 2rem 0;">
        <img src="StockFlowChart.png" alt="Stock Flow Chart" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="selling-priorities-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('selling-priorities-modal')">&times;</button>
      <div class="modal-title">Selling Priorities</div>
      
      <div class="modal-section">
        <p>Categories all have rules in place that the system will adhere to so you will know each item is at the right category before you sell any stock.</p>
        
        <p>When you know what category your item is there are work flows to follow for processing your sale. If you need to step outside that work flow you can request to do so.</p>
        
        <p>The work flows allow you to process the sale without an approval process and the changes we have made to the system will make much of the back office processes automatic.</p>
      </div>
      
      <div style="text-align: center; margin: 2rem 0;">
        <img src="stockcontrol.png" alt="Stock Control Process" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="halcyon-stock-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('halcyon-stock-modal')">&times;</button>
      <div class="modal-title">Halcyon Stock</div>
      
      <div class="modal-section">
        <h3>Stock Movements</h3>
        <p>All requests for stock for the gallery or to even leave the gallery must go through your Director of Private Clients (DOPC). Your DOPC will then confirm this with you once they have authorisation from Paul Watson.</p>
        
        <p><strong>DO NOT move any stock without the correct approval.</strong></p>
        
        <p>This means you will not be able to take artwork to a client's house other than a viewing without the correct authorisation as each piece is bonded, this includes LQU's.</p>
      </div>
      
      <div class="modal-section">
        <h3>QR Code Tracking</h3>
        <p>Every Halcyon piece of artwork is soon to have a QR code which will need to be scanned at every location (in the same way as WG/CFA stock). This will allow us and Halcyon to keep track of the location of each Halcyon piece, which they may do spot checks.</p>
        
        <p><strong>If a piece of artwork is not where it is supposed to be, the gallery will be held accountable. This will be reported to Halcyon Directors.</strong></p>
      </div>
    </div>
  </div>
  
</main>

<!-- Address Book Modal -->
<div id="addressBookModal" class="address-book-modal">
  <div class="address-book-modal-content">
    <div class="address-book-modal-header">
      <h2>📞 Address Book</h2>
      <span class="address-book-close" id="closeAddressBook">&times;</span>
    </div>
    <div class="address-book-modal-body">
      <div class="modal-app">
        <div class="modal-search-top">
          <label for="addressBookSearch">Quick find</label>
          <input id="addressBookSearch" type="text" placeholder="Search by name, email, phone or department... (Esc to clear)" />
        </div>
        
        <div class="modal-stage-wrap">
          <div class="modal-rolodex" aria-live="polite">
            <div class="modal-index" id="modalCursorIndex">0 / 0</div>
            <div class="modal-spindle" aria-hidden="true"></div>
            <div class="modal-knob left" title="Previous">
              <button type="button" id="modalPrev" aria-label="Previous card">◀</button>
            </div>
            <div class="modal-knob right" title="Next">
              <button type="button" id="modalNext" aria-label="Next card">▶</button>
            </div>
            <div class="modal-ring" id="modalRing"></div>
          </div>
          
          <div class="modal-controls">
            <button class="modal-circle-btn" id="modalJumpA" title="Jump to A">A</button>
            <button class="modal-circle-btn" id="modalJumpB" title="Jump to B">B</button>
            <button class="modal-circle-btn" id="modalJumpG" title="Jump to G">G</button>
            <button class="modal-circle-btn" id="modalJumpL" title="Jump to L">L</button>
            <button class="modal-circle-btn" id="modalJumpM" title="Jump to M">M</button>
            <button class="modal-circle-btn" id="modalJumpS" title="Jump to S">S</button>
            <button class="modal-circle-btn" id="modalJumpW" title="Jump to W">W</button>
            <button class="modal-circle-btn" id="modalJumpZ" title="Jump to Z">Z</button>
          </div>
          
          <div class="modal-controls-bottom">
            <button id="modalAddContactBtn" class="modal-add-contact-btn">+ Add Contact</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Contact Form Modal (inside Address Book) -->
<div id="contactFormModal" class="contact-form-modal">
  <div class="contact-form-modal-content">
    <div class="contact-form-modal-header">
      <h3>Add a contact</h3>
      <span class="contact-form-close" id="closeContactForm">&times;</span>
    </div>
    <form id="modalContactForm">
      <div class="contact-form-group">
        <label for="modalName" class="contact-form-label">Full name</label>
        <input id="modalName" name="name" type="text" class="contact-form-input" placeholder="John Smith" required />
      </div>
      
      <div class="contact-form-group">
        <label for="modalEmail" class="contact-form-label">Email <span class="tiny">(optional)</span></label>
        <input id="modalEmail" name="email" type="email" class="contact-form-input" placeholder="john@castlefineart.com" />
      </div>
      
      <div class="contact-form-group">
        <label for="modalPhone" class="contact-form-label">Phone <span class="tiny">(optional)</span></label>
        <input id="modalPhone" name="phone" type="tel" class="contact-form-input" placeholder="01216550060" />
      </div>
      
      <div class="contact-form-group">
        <label for="modalLabel" class="contact-form-label">Department <span class="tiny">(e.g. COFT)</span></label>
        <input id="modalLabel" name="label" type="text" class="contact-form-input" placeholder="Department" />
      </div>
      
      <div class="contact-form-actions">
        <button type="submit">Add to Address Book</button>
        <button class="danger" id="modalClearAll" type="button" title="Clear all contacts">Clear All</button>
      </div>
    </form>
  </div>
</div>

<!-- Card Template for Address Book -->
<template id="modalCardTemplate">
  <article class="modal-card" role="group" aria-roledescription="Address card">
    <div></div>
    <h3 class="name"></h3>
    <div class="tag"></div>
    <div class="company">Castle Fine Art</div>
    <div class="meta contact-info">
      <div class="phone"></div>
      <div class="email"></div>
    </div>
  </article>
</template>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<!-- Firebase config -->
<script src="firebase-init.js"></script>

<!-- Shared components -->
<script src="shared-components.js"></script>

<!-- Staff Hierarchy Logic -->
<script>
let navigationStack = [];

document.addEventListener('DOMContentLoaded', function() {
  const staffMembers = document.querySelectorAll('.staff-member.clickable');
  
  staffMembers.forEach(member => {
    member.addEventListener('click', function() {
      const staffId = this.dataset.staff;
      const subordinatesId = `${staffId}-subordinates`;
      const subordinates = document.getElementById(subordinatesId);
      
      if (subordinates) {
        const isCurrentlyExpanded = this.classList.contains('expanded');
        
        if (isCurrentlyExpanded) {
          // Collapsing - go back one level
          goBack();
        } else {
          // Expanding - show subordinates with manager context
          expandSection(staffId, subordinates, this);
        }
      }
    });
  });
});

function expandSection(staffId, subordinates, clickedElement) {
  // Save current state to navigation stack
  const currentState = {
    visibleSections: [],
    expandedElements: []
  };
  
  // Store currently visible sections
  document.querySelectorAll('.subordinates.show').forEach(section => {
    currentState.visibleSections.push(section.id);
  });
  
  // Store currently expanded elements
  document.querySelectorAll('.staff-member.expanded').forEach(element => {
    currentState.expandedElements.push(element.dataset.staff);
  });
  
  navigationStack.push(currentState);
  
  // Hide all current sections
  document.querySelectorAll('.subordinates.show').forEach(section => {
    section.classList.remove('show');
  });
  
  // Remove expanded state from all elements
  document.querySelectorAll('.staff-member.expanded').forEach(element => {
    element.classList.remove('expanded');
  });
  
  // Hide top level sections if we're expanding from top level
  const topLevelSection = document.querySelector('.hierarchy-level');
  if (clickedElement.closest('.hierarchy-level')) {
    topLevelSection.style.display = 'none';
  }
  
  // Show the subordinates section with manager context
  subordinates.classList.add('show');
  clickedElement.classList.add('expanded');
  
  // Show the manager context
  const contextId = `${staffId}-context`;
  const context = document.getElementById(contextId);
  if (context) {
    context.classList.add('show');
  }
  
  // Show the back button
  const backButton = document.getElementById('back-button');
  if (backButton) {
    backButton.classList.add('show');
  }
  
  // Add expanded class to container for larger content
  document.querySelector('.staff-container').classList.add('expanded');
  
  // Update title based on the manager clicked
  updateTitle(staffId);
}

function goBack() {
  if (navigationStack.length === 0) {
    // If no navigation history, show everything
    showAllSections();
    return;
  }
  
  const previousState = navigationStack.pop();
  
  // Hide all current sections
  document.querySelectorAll('.subordinates.show').forEach(section => {
    section.classList.remove('show');
  });
  
  // Hide all manager contexts
  document.querySelectorAll('.manager-context.show').forEach(context => {
    context.classList.remove('show');
  });
  
  // Hide back button if returning to top level
  const backButton = document.getElementById('back-button');
  if (navigationStack.length === 0 && backButton) {
    backButton.classList.remove('show');
  }
  
  // Remove expanded state from all elements
  document.querySelectorAll('.staff-member.expanded').forEach(element => {
    element.classList.remove('expanded');
  });
  
  if (navigationStack.length === 0) {
    // Back to top level
    showAllSections();
  } else {
    // Restore previous state
    previousState.visibleSections.forEach(sectionId => {
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.add('show');
        
        // Show manager context if it exists
        const contextId = sectionId.replace('-subordinates', '-context');
        const context = document.getElementById(contextId);
        if (context) {
          context.classList.add('show');
        }
      }
    });
    
    previousState.expandedElements.forEach(staffId => {
      const element = document.querySelector(`[data-staff="${staffId}"]`);
      if (element) {
        element.classList.add('expanded');
      }
    });
    
    // Keep container expanded if there are visible sections
    if (previousState.visibleSections.length > 0) {
      document.querySelector('.staff-container').classList.add('expanded');
    }
    
    // Update title based on what's currently visible
    if (previousState.expandedElements.length > 0) {
      updateTitle(previousState.expandedElements[previousState.expandedElements.length - 1]);
    }
  }
}

function showAllSections() {
  // Show top level
  const topLevelSection = document.querySelector('.hierarchy-level');
  if (topLevelSection) {
    topLevelSection.style.display = 'flex';
  }
  
  // Hide all subordinate sections
  document.querySelectorAll('.subordinates').forEach(section => {
    section.classList.remove('show');
  });
  
  // Hide all manager contexts
  document.querySelectorAll('.manager-context').forEach(context => {
    context.classList.remove('show');
  });
  
  // Hide back button
  const backButton = document.getElementById('back-button');
  if (backButton) {
    backButton.classList.remove('show');
  }
  
  // Remove expanded state from all elements
  document.querySelectorAll('.staff-member.expanded').forEach(element => {
    element.classList.remove('expanded');
  });
  
  // Remove expanded class from container to make it compact
  document.querySelector('.staff-container').classList.remove('expanded');
  
  // Clear navigation stack
  navigationStack = [];
  
  // Reset title to default
  updateTitle('default');
}

function updateTitle(staffId) {
  const titleElement = document.getElementById('staff-title');
  const titleMap = {
    'paul-chapman': 'Client Order Fulfilment Team',
    'martin-harrison': 'Manufacturing and QC',
    'gary-day': 'Framing',
    'martin-sumner': 'Stock Control',
    'stuart-whitehouse': 'Logistics',
    'gary-turpin': 'Operations',
    'matt-king': 'Inventory',
    'default': 'Spitfire Staff'
  };
  
  const newTitle = titleMap[staffId] || titleMap['default'];
  titleElement.textContent = newTitle;
}

// Modal Functions
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
  }
}

// Close modal when clicking outside
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('modal-overlay')) {
    const modalId = e.target.id;
    closeModal(modalId);
  }
});

// Close modal with ESC key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const activeModal = document.querySelector('.modal-overlay.active');
    if (activeModal) {
      closeModal(activeModal.id);
    }
  }
});


// Mobile Card-Based Navigation System
let mobileCurrentLevel = 'top';
let mobileNavigationStack = [];
let mobileStaffData = {};

// Initialize mobile navigation on page load
document.addEventListener('DOMContentLoaded', function() {
  if (window.innerWidth <= 768) {
    initializeMobileNavigation();
  }
  
  // Handle window resize
  window.addEventListener('resize', function() {
    if (window.innerWidth <= 768) {
      if (document.getElementById('mobile-staff-container').style.display === 'none') {
        initializeMobileNavigation();
      }
    } else {
      hideMobileNavigation();
    }
  });
});

function initializeMobileNavigation() {
  // Show mobile containers
  document.getElementById('mobile-staff-container').style.display = 'block';
  document.getElementById('mobile-bottom-nav').style.display = 'flex';
  
  // Build staff data structure from existing HTML
  buildMobileStaffData();
  
  // Show top level
  mobileShowLevel('top');
}

function hideMobileNavigation() {
  document.getElementById('mobile-staff-container').style.display = 'none';
  document.getElementById('mobile-bottom-nav').style.display = 'none';
}

function buildMobileStaffData() {
  mobileStaffData = {
    'top': {
      title: 'Spitfire Staff',
      staff: [
        {
          id: 'gary-turpin',
          name: 'Gary Turpin',
          title: 'Head of Operations',
          photo: 'staff/Gary Turpin - Head of Operations Updated.jpg',
          email: 'gturpin@washingtongreen.co.uk',
          hasTeam: true
        },
        {
          id: 'matt-king',
          name: 'Matt King',
          title: 'Head Of Inventory',
          photo: 'staff/Matt King - Head Of Inventory.jpg',
          email: 'mking@castlefineart.com',
          hasTeam: true
        }
      ]
    },
    'gary-turpin': {
      title: 'Gary Turpin\'s Team',
      staff: [
        {
          id: 'martin-harrison',
          name: 'Martin Harrison',
          title: 'Head of Manufacturing and QC',
          photo: 'staff/Martin Harrison - Head of Manufacturing and QC.jpg',
          email: 'mharrison@washingtongreen.co.uk',
          hasTeam: true
        },
        {
          id: 'paul-chapman',
          name: 'Paul Chapman',
          title: 'Client Order Fulfilment Team Manager',
          photo: 'staff/Order Processing/Chappie.jpg',
          email: 'pchapman@washingtongreen.co.uk',
          hasTeam: true
        },
        {
          id: 'stuart-whitehouse',
          name: 'Stuart Whitehouse',
          title: 'Logistics Manager',
          photo: 'staff/Stuart Whitehouse - Logistics Manager.jpg',
          email: 'swhitehouse@washingtongreen.co.uk',
          hasTeam: true
        }
      ]
    },
    'matt-king': {
      title: 'Matt King\'s Team',
      staff: [
        {
          id: 'martin-sumner',
          name: 'Martin Sumner',
          title: 'Head Of Stock Control',
          photo: 'staff/Martin Sumner - Head Of Stock Control.jpg',
          email: 'msumner@washingtongreen.co.uk',
          hasTeam: true
        },
        {
          id: 'raksha-hercombe',
          name: 'Raksha Hercombe',
          title: 'Halcyon Support Manager',
          photo: 'staff/Raksha Hercombe - Halcyon Support Manager.jpg',
          email: 'rhercombe@washingtongreen.co.uk',
          hasTeam: false
        },
        {
          id: 'alexandra-bradley',
          name: 'Alexandra Bradley',
          title: 'Originals Admin',
          photo: 'staff/Alexandra Bradley - Originals Admin.jpg',
          email: 'abradley@washingtongreen.co.uk',
          hasTeam: false
        }
      ]
    },
    'paul-chapman': {
      title: 'Paul Chapman\'s Team',
      staff: [
        {
          id: 'jenny-durrant',
          name: 'Jenny Durrant',
          title: 'Client Order Fulfilment Supervisor',
          photo: 'staff/Order Processing/Jenny.jpg',
          email: 'jdurrant@washingtongreen.co.uk',
          hasTeam: false
        },
        {
          id: 'gerald-hooper',
          name: 'Gerald Hooper',
          title: 'Senior Client Order Fulfilment Coordinator',
          photo: 'staff/Order Processing/Gerald.jpg',
          email: 'ghooper@castlegalleries.com',
          hasTeam: false
        },
        {
          id: 'katie-lewis',
          name: 'Katie Lewis',
          title: 'Client Order Fulfilment Administration Coordinator',
          photo: 'staff/Order Processing/Katie.jpg',
          email: 'klewis@castlefineart.com',
          hasTeam: false
        },
        {
          id: 'tara-platts',
          name: 'Tara Platts',
          title: 'Client Order Fulfilment Coordinator',
          photo: 'staff/Order Processing/Tara.jpg',
          email: 'tplatts@castlefineart.com',
          hasTeam: false
        },
        {
          id: 'phillippa-beevor-reid',
          name: 'Phillippa Beevor-Reid',
          title: 'Client Order Fulfilment Coordinator',
          photo: 'staff/Order Processing/Pip.jpg',
          email: 'pbeevor-reid@castlefineart.com',
          hasTeam: false
        },
        {
          id: 'amelia-rush',
          name: 'Amelia Rush',
          title: 'Client Order Fulfilment Coordinator',
          photo: 'staff/Order Processing/Amelia.jpg',
          email: 'arush@castlefineart.com',
          hasTeam: false
        }
      ]
    },
    'stuart-whitehouse': {
      title: 'Stuart Whitehouse\'s Team',
      staff: [
        {
          id: 'nathan-smethurst',
          name: 'Nathan Smethurst',
          title: 'Shipping Supervisor',
          photo: 'staff/Nathan Smethurst - Shipping Supervisor.jpg',
          email: 'nsmethurst@castlefineart.com',
          hasTeam: false
        },
        {
          id: 'olly-clark',
          name: 'Olly Clark',
          title: 'Packing Supervisor',
          photo: 'staff/Olly Clark - Packing Supervisor.jpg',
          email: 'oclark@washingtongreen.co.uk',
          hasTeam: false
        },
        {
          id: 'zara-chaudhry',
          name: 'Zara Chaudhry',
          title: 'Logistics Admin Assistant',
          photo: 'staff/Zara Chaudhry - Logistics Admin Assistant.jpg',
          email: 'zchaudhry@washingtongren.co.uk',
          hasTeam: false
        }
      ]
    },
    'martin-harrison': {
      title: 'Martin Harrison\'s Team',
      staff: [
        {
          id: 'gary-day',
          name: 'Gary Day',
          title: 'Framing Production Manager',
          photo: 'staff/Gary Day - Framing Production Manager.jpg',
          email: 'gday@washingtongreen.co.uk',
          hasTeam: true
        },
        {
          id: 'tom-harrison',
          name: 'Tom Harrison',
          title: 'Senior Mounting Operative',
          photo: 'staff/Tom Harrison - Senior Mounting Operative.jpg',
          email: 'tharrison@castlefineart.com',
          hasTeam: false
        },
        {
          id: 'chrissy-hall',
          name: 'Chrissy Hall',
          title: 'Quality Control Supervisor',
          photo: 'staff/Chrissy Hall - Quality Control Supervisor.jpg',
          email: 'chall@washingtongreen.co.uk',
          hasTeam: false
        }
      ]
    },
    'martin-sumner': {
      title: 'Martin Sumner\'s Team',
      staff: [
        {
          id: 'kerry-hinks',
          name: 'Kerry Hinks',
          title: 'Stock Admin Manager',
          photo: 'staff/Kerry Hinks - Stock Admin Manager.jpg',
          email: 'khinks@washingtongreen.co.uk',
          hasTeam: false
        },
        {
          id: 'adam-hercombe',
          name: 'Adam Hercombe',
          title: 'Warehouse Stock Manager',
          photo: 'staff/Adam Hercombe - Warehouse Stock Manager.jpg',
          email: 'ahercombe@washingtongreen.co.uk',
          hasTeam: false
        }
      ]
    },
    'gary-day': {
      title: 'Gary Day\'s Team',
      staff: [
        {
          id: 'bill-chand',
          name: 'Bill Chand',
          title: 'Framing Supervisor',
          photo: 'staff/Bill Chand - Framing Supervisor.jpg',
          email: null,
          hasTeam: false
        },
        {
          id: 'adam-hyde',
          name: 'Adam Hyde',
          title: 'Framing Supervisor (Cutting Room)',
          photo: 'staff/Adam Hyde - Framing Supervisor (Cutting Room).jpg',
          email: null,
          hasTeam: false
        }
      ]
    }
  };
}

function mobileShowLevel(levelId) {
  const levelData = mobileStaffData[levelId];
  if (!levelData) {
    console.error('Level not found:', levelId);
    return;
  }
  
  mobileCurrentLevel = levelId;
  
  // Update breadcrumb and navigation
  updateMobileBreadcrumb(levelData.title);
  updateMobileBackButton();
  
  // Clear and populate staff grid
  const grid = document.getElementById('mobile-staff-grid');
  grid.innerHTML = '';
  
  levelData.staff.forEach(person => {
    const card = createMobileStaffCard(person);
    grid.appendChild(card);
  });
}

function createMobileStaffCard(person) {
  const card = document.createElement('div');
  card.className = `mobile-staff-card ${person.hasTeam ? 'has-team' : ''}`;
  
  const emailLink = person.email ? 
    `<a href="mailto:${person.email}" class="copy-email" title="Send email" onclick="event.stopPropagation()">📋</a>` : 
    '';
  
  card.innerHTML = `
    <img src="${person.photo}" alt="${person.name}" class="mobile-staff-photo" />
    <div class="mobile-staff-info">
      <div class="mobile-staff-name">
        ${person.name} ${emailLink}
      </div>
      <div class="mobile-staff-title">${person.title}</div>
      ${person.hasTeam ? '<div class="mobile-team-count">Has team members</div>' : ''}
    </div>
  `;
  
  if (person.hasTeam) {
    card.addEventListener('click', () => {
      mobileNavigationStack.push(mobileCurrentLevel);
      mobileShowLevel(person.id);
    });
  } else {
    card.addEventListener('click', () => {
      // Show individual staff member modal (reuse existing modal functionality)
      const staffElement = document.querySelector(`[data-staff="${person.id}"]`);
      if (staffElement) {
        staffElement.click();
      }
    });
  }
  
  return card;
}

function updateMobileBreadcrumb(title) {
  document.getElementById('mobile-breadcrumb').textContent = title;
}

function updateMobileBackButton() {
  const navHeader = document.getElementById('mobile-nav-header');
  const backButton = document.getElementById('mobile-back-button');
  
  if (mobileCurrentLevel === 'top') {
    navHeader.style.display = 'none';
  } else {
    navHeader.style.display = 'flex';
    backButton.disabled = mobileNavigationStack.length === 0;
  }
}

function mobileGoBack() {
  if (mobileNavigationStack.length > 0) {
    const previousLevel = mobileNavigationStack.pop();
    mobileShowLevel(previousLevel);
  }
}

function mobileShowAll() {
  // Reset to top level
  mobileNavigationStack = [];
  mobileShowLevel('top');
}

</script>

<!-- Site scripts -->
<script src="script.js?v=20250822_095956_chatbot_cache_bust"></script>


<!-- Notification system -->

<!-- Address Book Functionality -->
<script>
(function() {
  // Address Book Modal Management
  const addressBookModal = document.getElementById('addressBookModal');
  const contactFormModal = document.getElementById('contactFormModal');
  const openAddressBookBtn = document.getElementById('openAddressBookBtn');
  const closeAddressBook = document.getElementById('closeAddressBook');
  const closeContactForm = document.getElementById('closeContactForm');
  
  // Address Book Variables
  const modalRing = document.getElementById('modalRing');
  const modalForm = document.getElementById('modalContactForm');
  const modalQ = document.getElementById('addressBookSearch');
  const modalIndex = document.getElementById('modalCursorIndex');
  const modalPrev = document.getElementById('modalPrev');
  const modalNext = document.getElementById('modalNext');
  const modalAddContactBtn = document.getElementById('modalAddContactBtn');
  const modalClearAll = document.getElementById('modalClearAll');
  
  let modalContacts = JSON.parse(localStorage.getItem('addressBookContacts') || '[]');
  let modalCurrentIndex = 0;
  let modalFiltered = [];
  
  // Modal open/close handlers
  openAddressBookBtn.addEventListener('click', () => {
    addressBookModal.style.display = 'block';
    document.body.style.overflow = 'hidden';
    modalInit();
  });
  
  closeAddressBook.addEventListener('click', () => {
    addressBookModal.style.display = 'none';
    document.body.style.overflow = 'auto';
  });
  
  closeContactForm.addEventListener('click', () => {
    contactFormModal.style.display = 'none';
  });
  
  // Close modals when clicking outside
  window.addEventListener('click', (event) => {
    if (event.target === addressBookModal) {
      addressBookModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
    if (event.target === contactFormModal) {
      contactFormModal.style.display = 'none';
    }
  });
  
  // Address Book Core Functions
  function modalInit() {
    modalContacts = JSON.parse(localStorage.getItem('addressBookContacts') || '[]');
    modalFiltered = [...modalContacts];
    modalCurrentIndex = 0;
    modalRender();
    modalUpdateIndex();
  }
  
  function modalRender() {
    modalRing.innerHTML = '';
    if (modalFiltered.length === 0) {
      modalRing.innerHTML = '<div class="modal-card"><h3>No contacts found</h3><p>Add some contacts to get started!</p></div>';
      return;
    }
    
    modalFiltered.forEach((contact, i) => {
      const template = document.getElementById('modalCardTemplate');
      const clone = template.content.cloneNode(true);
      const card = clone.querySelector('.modal-card');
      
      clone.querySelector('.name').textContent = contact.name;
      clone.querySelector('.tag').textContent = contact.label || 'General';
      clone.querySelector('.phone').textContent = contact.phone || '';
      clone.querySelector('.email').textContent = contact.email || '';
      
      const angle = (i / modalFiltered.length) * 360;
      card.style.transform = \`rotateY(\${angle}deg) translateZ(300px)\`;
      card.style.opacity = i === modalCurrentIndex ? '1' : '0.3';
      
      modalRing.appendChild(clone);
    });
  }
  
  function modalUpdateIndex() {
    modalIndex.textContent = modalFiltered.length ? \`\${modalCurrentIndex + 1} / \${modalFiltered.length}\` : '0 / 0';
  }
  
  function modalRotateToIndex(index) {
    if (modalFiltered.length === 0) return;
    
    modalCurrentIndex = ((index % modalFiltered.length) + modalFiltered.length) % modalFiltered.length;
    const angle = -(modalCurrentIndex / modalFiltered.length) * 360;
    modalRing.style.transform = \`rotateY(\${angle}deg)\`;
    
    const cards = modalRing.querySelectorAll('.modal-card');
    cards.forEach((card, i) => {
      card.style.opacity = i === modalCurrentIndex ? '1' : '0.3';
    });
    
    modalUpdateIndex();
  }
  
  function modalSearch(query) {
    if (!query.trim()) {
      modalFiltered = [...modalContacts];
    } else {
      const q = query.toLowerCase();
      modalFiltered = modalContacts.filter(contact =>
        contact.name.toLowerCase().includes(q) ||
        (contact.email && contact.email.toLowerCase().includes(q)) ||
        (contact.phone && contact.phone.includes(q)) ||
        (contact.label && contact.label.toLowerCase().includes(q))
      );
    }
    modalCurrentIndex = 0;
    modalRender();
    modalRotateToIndex(0);
  }
  
  function modalJumpToLetter(letter) {
    const index = modalFiltered.findIndex(contact => 
      contact.name.toLowerCase().startsWith(letter.toLowerCase())
    );
    if (index !== -1) {
      modalRotateToIndex(index);
    }
  }
  
  function modalSaveContacts() {
    localStorage.setItem('addressBookContacts', JSON.stringify(modalContacts));
  }
  
  // Event Listeners
  modalPrev?.addEventListener('click', () => modalRotateToIndex(modalCurrentIndex - 1));
  modalNext?.addEventListener('click', () => modalRotateToIndex(modalCurrentIndex + 1));
  
  modalQ?.addEventListener('input', (e) => modalSearch(e.target.value));
  modalQ?.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      e.target.value = '';
      modalSearch('');
    }
  });
  
  // Jump buttons
  document.getElementById('modalJumpA')?.addEventListener('click', () => modalJumpToLetter('A'));
  document.getElementById('modalJumpB')?.addEventListener('click', () => modalJumpToLetter('B'));
  document.getElementById('modalJumpG')?.addEventListener('click', () => modalJumpToLetter('G'));
  document.getElementById('modalJumpL')?.addEventListener('click', () => modalJumpToLetter('L'));
  document.getElementById('modalJumpM')?.addEventListener('click', () => modalJumpToLetter('M'));
  document.getElementById('modalJumpS')?.addEventListener('click', () => modalJumpToLetter('S'));
  document.getElementById('modalJumpW')?.addEventListener('click', () => modalJumpToLetter('W'));
  document.getElementById('modalJumpZ')?.addEventListener('click', () => modalJumpToLetter('Z'));
  
  // Add contact button
  modalAddContactBtn?.addEventListener('click', () => {
    contactFormModal.style.display = 'block';
  });
  
  // Contact form submission
  modalForm?.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const formData = new FormData(modalForm);
    const contact = {
      name: formData.get('name').trim(),
      email: formData.get('email').trim(),
      phone: formData.get('phone').trim(),
      label: formData.get('label').trim(),
      id: Date.now().toString()
    };
    
    if (!contact.name) return;
    
    modalContacts.push(contact);
    modalContacts.sort((a, b) => a.name.localeCompare(b.name));
    modalSaveContacts();
    
    modalForm.reset();
    contactFormModal.style.display = 'none';
    modalInit();
  });
  
  // Clear all contacts
  modalClearAll?.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear all contacts? This cannot be undone.')) {
      modalContacts = [];
      modalSaveContacts();
      modalInit();
      contactFormModal.style.display = 'none';
    }
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (addressBookModal.style.display !== 'block') return;
    
    switch(e.key) {
      case 'ArrowLeft':
        e.preventDefault();
        modalRotateToIndex(modalCurrentIndex - 1);
        break;
      case 'ArrowRight':
        e.preventDefault();
        modalRotateToIndex(modalCurrentIndex + 1);
        break;
      case 'Escape':
        if (contactFormModal.style.display === 'block') {
          contactFormModal.style.display = 'none';
        } else {
          addressBookModal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
        break;
    }
  });
})();
</script>

<!-- Contact Chatbot -->
<style>
  /* Chatbot styles */
  .cc-launcher {
    position: fixed; 
    right: 20px; 
    bottom: 20px; 
    z-index: 999999;
    border: none; 
    border-radius: 25px; 
    cursor: pointer;
    background: #45494e;
    color: #ffffff;
    box-shadow: 0 24px 60px rgba(22,25,28,0.16);
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    font-size: 14px;
    font-weight: 600;
    transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
  }
  .cc-launcher:hover { 
    transform: translateY(-2px); 
    filter: brightness(1.05); 
  }
  .cc-launcher-icon {
    font-size: 20px;
  }

  /* Widget panel */
  .cc-widget {
    position: fixed; 
    right: 20px; 
    bottom: 90px; 
    z-index: 999999; 
    display: none;
    width: 380px; 
    max-height: 74vh; 
    background: #ffffff;
    border: 1px solid rgba(69,73,78,0.15); 
    border-radius: 16px;
    box-shadow: 0 24px 60px rgba(22,25,28,0.16); 
    overflow: hidden; 
    flex-direction: column;
  }
  .cc-widget.open { 
    display: flex; 
  }

  .cc-header {
    background: linear-gradient(180deg, #d8d1c5, #ece7de);
    padding: 12px 16px; 
    border-bottom: 1px solid rgba(69,73,78,0.12);
    display: flex; 
    align-items: center; 
    gap: 10px; 
    color: #2b2f33;
  }
  .cc-mark {
    width: 36px; 
    height: 36px; 
    border-radius: 10px;
    background: #45494e;
    display: grid; 
    place-items: center; 
    color: #ffffff; 
    font-weight: 700;
    box-shadow: 0 4px 14px rgba(69,73,78,.25);
  }
  .cc-header h3 { 
    margin: 0; 
    font-size: 15px; 
    line-height: 1.2; 
    font-weight: 700; 
  }
  .cc-header small { 
    display: block; 
    color: #72777d; 
    font-weight: 500; 
  }
  .cc-close { 
    margin-left: auto; 
    border: none; 
    background: transparent; 
    color: #363a3f; 
    cursor: pointer; 
    width: 34px; 
    height: 34px; 
    border-radius: 8px; 
  }
  .cc-close:hover { 
    background: rgba(69,73,78,0.08); 
  }

  .cc-messages { 
    flex: 1; 
    overflow-y: auto; 
    padding: 14px 14px 0 14px; 
    background: linear-gradient(180deg, rgba(216,209,197,0.16), rgba(216,209,197,0));
  }

  .cc-bubble { 
    max-width: 82%; 
    margin: 10px 0; 
    padding: 10px 12px; 
    border-radius: 12px; 
    line-height: 1.45; 
    font-size: 14px; 
  }
  .cc-bubble.user { 
    margin-left: auto; 
    color: #ffffff; 
    background: #45494e; 
    border-top-right-radius: 6px; 
  }
  .cc-bubble.bot { 
    margin-right: auto; 
    background: #f6f4f1; 
    border: 1px solid rgba(69,73,78,0.12); 
    border-top-left-radius: 6px; 
  }

  .cc-typing { 
    display: none; 
    text-align: center; 
    padding: 8px 0 4px; 
  }
  .cc-dot { 
    width: 8px; 
    height: 8px; 
    display: inline-block; 
    border-radius: 50%; 
    background: #c1b9ad; 
    margin: 0 2px; 
    animation: ccDot 1.4s infinite; 
    opacity: .9; 
  }
  .cc-dot:nth-child(2) { animation-delay: .2s; }
  .cc-dot:nth-child(3) { animation-delay: .4s; }
  @keyframes ccDot { 
    0%, 60%, 100% { transform: translateY(0); } 
    30% { transform: translateY(-6px); } 
  }

  .cc-input-area { 
    padding: 12px; 
    border-top: 1px solid rgba(69,73,78,0.12); 
    background: #faf9f7; 
  }
  .cc-row { 
    display: flex; 
    gap: 8px; 
  }
  .cc-input { 
    flex: 1; 
    border: 1px solid rgba(69,73,78,0.25); 
    background: #fff; 
    color: #2b2f33; 
    border-radius: 12px; 
    padding: 10px 12px; 
    outline: none; 
    font-size: 14px; 
  }
  .cc-input:focus { 
    box-shadow: 0 0 0 3px rgba(69,73,78,0.18); 
    border-color: #45494e; 
  }
  .cc-send { 
    background: #45494e; 
    color: #fff; 
    border: none; 
    padding: 0 14px; 
    border-radius: 10px; 
    cursor: pointer; 
    font-weight: 600; 
  }
  .cc-send:hover { 
    filter: brightness(1.05); 
  }

  .cc-suggestions { 
    padding: 8px 0 0; 
    display: flex; 
    gap: 6px; 
    flex-wrap: wrap; 
  }
  .cc-chip { 
    font-size: 12px; 
    padding: 6px 10px; 
    background: #f1efeb; 
    border: 1px solid rgba(69,73,78,0.14); 
    color: #4a4f54; 
    border-radius: 999px; 
    cursor: pointer; 
  }
  .cc-chip:hover { 
    background: #ebe7e0; 
  }

  /* Contact cards */
  .cc-card { 
    background: #fff; 
    border: 1px solid rgba(69,73,78,0.12); 
    border-radius: 12px; 
    padding: 10px; 
    margin-top: 10px; 
  }
  .cc-team { 
    display: flex; 
    gap: 8px; 
    align-items: center; 
    font-weight: 700; 
    color: #2b2f33; 
  }
  .cc-tag { 
    margin-left: auto; 
    font-size: 12px; 
    padding: 2px 8px; 
    border-radius: 999px; 
    background: #f3f2ef; 
    border: 1px solid rgba(69,73,78,0.12); 
    color: #4a4f54; 
  }
  .cc-emails { 
    margin-top: 8px; 
  }
  .cc-email { 
    display: inline-block; 
    font-size: 12px; 
    margin: 4px 6px 0 0; 
    padding: 6px 10px; 
    border-radius: 999px; 
    background: #f6f4f1; 
    border: 1px solid rgba(69,73,78,0.12); 
    text-decoration: none; 
    color: #2b2f33; 
  }
  .cc-email:hover { 
    background: #d8d1c5; 
  }
  .cc-keywords { 
    margin-top: 8px; 
    font-size: 12px; 
    color: #5b6066; 
  }
  .cc-k { 
    background: rgba(216,209,197,.55); 
    color: #1f2327; 
    padding: 0 4px; 
    border-radius: 4px; 
    font-weight: 700; 
  }
  .cc-phone {
    margin-top: 6px; 
    font-size: 13px; 
    color: #4a4f54;
  }
  .cc-phone a {
    color: #2b2f33; 
    text-decoration: underline;
  }

  /* Match borders */
  .match-high { border-left: 4px solid #2f3438; }
  .match-medium { border-left: 4px solid #7f858b; }
  .match-low { border-left: 4px solid #c9c3b8; }

  @media (max-width: 480px) {
    .cc-widget { 
      right: 10px; 
      left: 10px; 
      width: auto; 
    }
    .cc-launcher {
      right: 10px;
    }
  }
</style>

<!-- Launcher Button -->
<button class="cc-launcher" id="cc-launcher" aria-label="Open contact helper" title="Contact Finder">
  <span class="cc-launcher-icon">💬</span>
  <span>Who do I contact?</span>
</button>

<!-- Chatbot Widget -->
<section class="cc-widget" id="cc-widget" aria-live="polite" aria-label="Contact Finder chatbot">
  <header class="cc-header">
    <div class="cc-mark">CC</div>
    <div>
      <h3>Who do I contact?</h3>
      <small>Describe your issue and I'll route you</small>
    </div>
    <button class="cc-close" id="cc-close" title="Close" aria-label="Close">✕</button>
  </header>

  <div class="cc-messages" id="cc-messages"></div>
  <div class="cc-typing" id="cc-typing">
    <span class="cc-dot"></span>
    <span class="cc-dot"></span>
    <span class="cc-dot"></span>
  </div>

  <div class="cc-input-area">
    <div class="cc-row">
      <input id="cc-input" class="cc-input" placeholder="e.g. I need to cancel my order" autocomplete="off" />
      <button id="cc-send" class="cc-send">Send</button>
    </div>
    <div class="cc-suggestions" id="cc-suggestions"></div>
  </div>
</section>

<script>
// Contact Chatbot functionality
(function() {
  let teamContacts = [];

  // Load team contacts from JSON
  async function loadTeamContacts() {
    try {
      const response = await fetch('team_contacts.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      teamContacts = await response.json();
      console.log('Team contacts loaded:', teamContacts.length, 'teams');
    } catch (error) {
      console.error('Failed to load team contacts:', error);
      addBot('Sorry, I\'m having trouble loading the team directory. Please try again later or contact Client Services directly.');
    }
  }

  // Matching utilities
  function levenshteinDistance(str1, str2) {
    const len1 = str1.length, len2 = str2.length;
    const dp = Array.from({ length: len2 + 1 }, (_, i) => [i]);
    for (let j = 0; j <= len1; j++) dp[0][j] = j;
    for (let i = 1; i <= len2; i++) {
      for (let j = 1; j <= len1; j++) {
        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
          dp[i][j] = dp[i-1][j-1];
        } else {
          dp[i][j] = Math.min(dp[i-1][j-1] + 1, dp[i][j-1] + 1, dp[i-1][j] + 1);
        }
      }
    }
    return dp[len2][len1];
  }

  function isFuzzyMatch(a, b, max = 2) {
    if (a.length < 4 || b.length < 4) return false;
    if (Math.abs(a.length - b.length) > max) return false;
    return levenshteinDistance(a.toLowerCase(), b.toLowerCase()) <= max;
  }

  function findMatchingTeams(query) {
    if (!query.trim() || teamContacts.length === 0) return [];
    
    const queryWords = query.toLowerCase().split(/\s+/).filter(w => w.length > 2);
    const matches = [];

    teamContacts.forEach(team => {
      let score = 0;
      const matchedKeywords = [];
      let hasExact = false;
      let hasFuzzy = false;

      // Exact matches
      team.keywords.forEach(kw => {
        const kwWords = kw.toLowerCase().split(/\s+/);
        queryWords.forEach(qw => {
          kwWords.forEach(kwd => {
            if (qw === kwd) {
              score += 100;
              hasExact = true;
              if (!matchedKeywords.includes(kw)) matchedKeywords.push(kw);
            }
          });
        });
      });

      // Fuzzy matches if no exact matches
      if (!hasExact) {
        team.keywords.forEach(kw => {
          const kwWords = kw.toLowerCase().split(/\s+/);
          queryWords.forEach(qw => {
            kwWords.forEach(kwd => {
              if (isFuzzyMatch(qw, kwd)) {
                score += 80;
                hasFuzzy = true;
                if (!matchedKeywords.includes(kw)) {
                  matchedKeywords.push(`${kw} (did you mean "${kwd}")`);
                }
              }
            });
          });
        });
      }

      // Partial matches if no exact or fuzzy matches
      if (!hasExact && !hasFuzzy) {
        team.keywords.forEach(kw => {
          const kwLower = kw.toLowerCase();
          if (query.toLowerCase().includes(kwLower)) {
            score += 50;
            if (!matchedKeywords.includes(kw)) matchedKeywords.push(kw);
            return;
          }
          queryWords.forEach(qw => {
            kwLower.split(/\s+/).forEach(kwd => {
              if (qw.includes(kwd) || kwd.includes(qw)) {
                score += 5;
                if (!matchedKeywords.includes(kw)) matchedKeywords.push(kw);
              }
            });
          });
        });
      }

      if (score > 0) {
        matches.push({ ...team, score, matchedKeywords });
      }
    });

    return matches.sort((a, b) => b.score - a.score);
  }

  // UI elements
  const widget = document.getElementById('cc-widget');
  const launcher = document.getElementById('cc-launcher');
  const closer = document.getElementById('cc-close');
  const messages = document.getElementById('cc-messages');
  const typing = document.getElementById('cc-typing');
  const input = document.getElementById('cc-input');
  const sendBtn = document.getElementById('cc-send');
  const suggestions = document.getElementById('cc-suggestions');

  const chips = [
    'cancel my order', 'damaged artwork', 'order tracking',
    'artist event', 'stock availability', 'installation help',
    'lost shipment', 'returns'
  ];

  function mountChips() {
    suggestions.innerHTML = chips.map(c => 
      `<button class="cc-chip" data-q="${c.replace(/"/g, '&quot;')}">${c}</button>`
    ).join('');
    
    suggestions.querySelectorAll('.cc-chip').forEach(el => {
      el.addEventListener('click', () => {
        input.value = el.dataset.q;
        submitQuery();
      });
    });
  }

  function addBot(html) {
    const b = document.createElement('div');
    b.className = 'cc-bubble bot';
    b.innerHTML = html;
    messages.appendChild(b);
    messages.scrollTop = messages.scrollHeight;
  }

  function addUser(text) {
    const b = document.createElement('div');
    b.className = 'cc-bubble user';
    b.textContent = text;
    messages.appendChild(b);
    messages.scrollTop = messages.scrollHeight;
  }

  function renderCards(matches, query) {
    if (!matches.length) {
      addBot(`No specific team found for "${escapeHtml(query)}".<br/>Try different keywords or contact <strong>Client Services</strong> for general help.`);
      return;
    }

    const html = matches.map((m) => {
      const level = m.score >= 100 ? 'high' : m.score >= 50 ? 'medium' : 'low';
      const pct = Math.min(Math.round((m.score / 100) * 100), 100);
      const emailTags = m.emails.map(e => 
        `<a class="cc-email" href="mailto:${e}?subject=${encodeURIComponent('Who do I contact? - ' + query)}">${e}</a>`
      ).join('');
      const kws = m.matchedKeywords.map(k => `<span class="cc-k">${escapeHtml(k)}</span>`).join(', ');
      const phone = m.phone ? `<div class="cc-phone">📞 <a href="tel:${m.phone}">${m.phone}</a></div>` : '';
      
      return `<div class="cc-card match-${level}">
        <div class="cc-team">💼 ${escapeHtml(m.team)} <span class="cc-tag">${pct}% match</span></div>
        ${phone}
        <div class="cc-emails">${emailTags}</div>
        <div class="cc-keywords">Matched: ${kws}</div>
      </div>`;
    }).join('');

    addBot(html);
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, m => ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    }[m]));
  }

  function submitQuery() {
    const q = input.value.trim();
    if (!q) return;
    
    addUser(q);
    input.value = '';
    typing.style.display = 'block';
    
    setTimeout(() => {
      const matches = findMatchingTeams(q);
      typing.style.display = 'none';
      renderCards(matches, q);
    }, 480);
  }

  // Event listeners
  launcher.addEventListener('click', () => {
    widget.classList.add('open');
    input.focus();
    if (!messages.dataset.seeded) {
      seedIntro();
      messages.dataset.seeded = '1';
    }
  });

  closer.addEventListener('click', () => {
    widget.classList.remove('open');
  });

  sendBtn.addEventListener('click', submitQuery);

  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') submitQuery();
  });

  function seedIntro() {
    addBot('Hi! 👋 Tell me what you need help with and I\'ll suggest the best team. Try typing something like <em>"I need to cancel my order"</em> or pick a suggestion below.');
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', async () => {
    await loadTeamContacts();
    mountChips();
  });
})();
</script>
</body>
</html>